<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hao Xian, Wen Yang and Pierre Jean Michel">
<meta name="dcterms.date" content="2023-03-11">

<title>IS415 GeoSpatial - Project Data-preprocessing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">IS415 GeoSpatial</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projectproposal.html">
 <span class="menu-text">Project Proposal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../poster.html">
 <span class="menu-text">Poster</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../report/report.pdf">
 <span class="menu-text">Project Report</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../userguide.html">
 <span class="menu-text">User Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../GWRProj/DataPreprocessing.html" aria-current="page">
 <span class="menu-text">Date Preprocessing for Shiny Model</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#loading-the-packages" id="toc-loading-the-packages" class="nav-link active" data-scroll-target="#loading-the-packages">Loading the Packages</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a>
  <ul class="collapse">
  <li><a href="#list-of-data" id="toc-list-of-data" class="nav-link" data-scroll-target="#list-of-data">List of Data</a></li>
  </ul></li>
  <li><a href="#preparing-the-aspatial-data" id="toc-preparing-the-aspatial-data" class="nav-link" data-scroll-target="#preparing-the-aspatial-data">Preparing the Aspatial Data</a>
  <ul class="collapse">
  <li><a href="#importing-the-resale-data" id="toc-importing-the-resale-data" class="nav-link" data-scroll-target="#importing-the-resale-data">Importing the Resale Data</a>
  <ul class="collapse">
  <li><a href="#filtering-the-aspatial-data" id="toc-filtering-the-aspatial-data" class="nav-link" data-scroll-target="#filtering-the-aspatial-data">Filtering the Aspatial Data</a></li>
  </ul></li>
  <li><a href="#transforming-the-resale-data" id="toc-transforming-the-resale-data" class="nav-link" data-scroll-target="#transforming-the-resale-data">Transforming the Resale Data</a>
  <ul class="collapse">
  <li><a href="#retrieving-postal-codes-and-coordinates-of-the-address" id="toc-retrieving-postal-codes-and-coordinates-of-the-address" class="nav-link" data-scroll-target="#retrieving-postal-codes-and-coordinates-of-the-address">Retrieving Postal Codes and Coordinates of the address</a></li>
  <li><a href="#transforming-remaining-lease" id="toc-transforming-remaining-lease" class="nav-link" data-scroll-target="#transforming-remaining-lease">Transforming Remaining Lease</a></li>
  <li><a href="#transforming-storey-range" id="toc-transforming-storey-range" class="nav-link" data-scroll-target="#transforming-storey-range">Transforming Storey Range</a></li>
  <li><a href="#transforming-age" id="toc-transforming-age" class="nav-link" data-scroll-target="#transforming-age">Transforming Age</a></li>
  <li><a href="#combining-all-the-data-and-storing-as-rds" id="toc-combining-all-the-data-and-storing-as-rds" class="nav-link" data-scroll-target="#combining-all-the-data-and-storing-as-rds">Combining all the data and storing as RDS</a></li>
  </ul></li>
  <li><a href="#viewing-rds-data" id="toc-viewing-rds-data" class="nav-link" data-scroll-target="#viewing-rds-data">Viewing RDS Data</a>
  <ul class="collapse">
  <li><a href="#reading-rds" id="toc-reading-rds" class="nav-link" data-scroll-target="#reading-rds">Reading RDS</a></li>
  <li><a href="#converting-to-sf-object" id="toc-converting-to-sf-object" class="nav-link" data-scroll-target="#converting-to-sf-object">Converting to Sf Object</a></li>
  <li><a href="#checking-for-invalid-geometries" id="toc-checking-for-invalid-geometries" class="nav-link" data-scroll-target="#checking-for-invalid-geometries">Checking for invalid geometries</a></li>
  <li><a href="#plotting-the-hdb-resale-points" id="toc-plotting-the-hdb-resale-points" class="nav-link" data-scroll-target="#plotting-the-hdb-resale-points">Plotting the HDB Resale points</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#preparing-the-locational-data" id="toc-preparing-the-locational-data" class="nav-link" data-scroll-target="#preparing-the-locational-data">Preparing the Locational Data</a>
  <ul class="collapse">
  <li><a href="#extracting-the-data-from-onemap-api" id="toc-extracting-the-data-from-onemap-api" class="nav-link" data-scroll-target="#extracting-the-data-from-onemap-api">Extracting the Data from OneMap API</a>
  <ul class="collapse">
  <li><a href="#step-1-searching-for-themes" id="toc-step-1-searching-for-themes" class="nav-link" data-scroll-target="#step-1-searching-for-themes">Step 1: Searching for Themes</a></li>
  <li><a href="#step-2-a-closer-look-at-each-theme" id="toc-step-2-a-closer-look-at-each-theme" class="nav-link" data-scroll-target="#step-2-a-closer-look-at-each-theme">Step 2: A Closer Look at each theme</a></li>
  <li><a href="#step-3-saving-the-data-into-a-data-frame" id="toc-step-3-saving-the-data-into-a-data-frame" class="nav-link" data-scroll-target="#step-3-saving-the-data-into-a-data-frame">Step 3: Saving the Data into a data frame</a></li>
  </ul></li>
  <li><a href="#extracting-the-other-data" id="toc-extracting-the-other-data" class="nav-link" data-scroll-target="#extracting-the-other-data">Extracting the Other Data</a></li>
  </ul></li>
  <li><a href="#load-in-all-the-shape-data" id="toc-load-in-all-the-shape-data" class="nav-link" data-scroll-target="#load-in-all-the-shape-data">Load in all the shape data</a>
  <ul class="collapse">
  <li><a href="#importing-supermarket-data" id="toc-importing-supermarket-data" class="nav-link" data-scroll-target="#importing-supermarket-data">Importing SuperMarket Data</a></li>
  <li><a href="#importing-the-resale-data-1" id="toc-importing-the-resale-data-1" class="nav-link" data-scroll-target="#importing-the-resale-data-1">Importing the Resale Data</a></li>
  </ul></li>
  <li><a href="#transforming-the-resale-data-1" id="toc-transforming-the-resale-data-1" class="nav-link" data-scroll-target="#transforming-the-resale-data-1">Transforming the Resale Data</a>
  <ul class="collapse">
  <li><a href="#retrieving-postal-codes-and-coordinates-of-the-address-1" id="toc-retrieving-postal-codes-and-coordinates-of-the-address-1" class="nav-link" data-scroll-target="#retrieving-postal-codes-and-coordinates-of-the-address-1">Retrieving Postal Codes and Coordinates of the address</a>
  <ul class="collapse">
  <li><a href="#step-1-combining-block-and-street-name-to-form-an-address-1" id="toc-step-1-combining-block-and-street-name-to-form-an-address-1" class="nav-link" data-scroll-target="#step-1-combining-block-and-street-name-to-form-an-address-1">Step 1: Combining Block and Street Name to form an address</a></li>
  <li><a href="#step-2-filtering-out-unique-address.-1" id="toc-step-2-filtering-out-unique-address.-1" class="nav-link" data-scroll-target="#step-2-filtering-out-unique-address.-1">Step 2: Filtering out Unique Address.</a></li>
  <li><a href="#step-3-retrieiving-coordinates-from-onemap-api-1" id="toc-step-3-retrieiving-coordinates-from-onemap-api-1" class="nav-link" data-scroll-target="#step-3-retrieiving-coordinates-from-onemap-api-1">Step 3: Retrieiving Coordinates from OneMap API</a></li>
  <li><a href="#step-4-inspecting-the-result-and-fixing-the-issues-1" id="toc-step-4-inspecting-the-result-and-fixing-the-issues-1" class="nav-link" data-scroll-target="#step-4-inspecting-the-result-and-fixing-the-issues-1">Step 4: Inspecting the Result and Fixing the Issues</a></li>
  </ul></li>
  <li><a href="#transforming-remaining-lease-1" id="toc-transforming-remaining-lease-1" class="nav-link" data-scroll-target="#transforming-remaining-lease-1">Transforming Remaining Lease</a></li>
  <li><a href="#transforming-storey-range-1" id="toc-transforming-storey-range-1" class="nav-link" data-scroll-target="#transforming-storey-range-1">Transforming Storey Range</a></li>
  <li><a href="#transforming-age-1" id="toc-transforming-age-1" class="nav-link" data-scroll-target="#transforming-age-1">Transforming Age</a></li>
  <li><a href="#calculating-proximity" id="toc-calculating-proximity" class="nav-link" data-scroll-target="#calculating-proximity">Calculating Proximity</a></li>
  <li><a href="#facility-count-within-radius" id="toc-facility-count-within-radius" class="nav-link" data-scroll-target="#facility-count-within-radius">Facility Count Within Radius</a></li>
  <li><a href="#saving-the-data-into-rds" id="toc-saving-the-data-into-rds" class="nav-link" data-scroll-target="#saving-the-data-into-rds">Saving the Data into RDS</a></li>
  </ul></li>
  <li><a href="#building-the-models" id="toc-building-the-models" class="nav-link" data-scroll-target="#building-the-models">Building the Models</a>
  <ul class="collapse">
  <li><a href="#generating-the-new-geographically-weighted-linear-model" id="toc-generating-the-new-geographically-weighted-linear-model" class="nav-link" data-scroll-target="#generating-the-new-geographically-weighted-linear-model">Generating the new GeoGraphically Weighted Linear Model</a>
  <ul class="collapse">
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">Loading the Data</a></li>
  <li><a href="#filtering-the-data" id="toc-filtering-the-data" class="nav-link" data-scroll-target="#filtering-the-data">Filtering the Data</a></li>
  <li><a href="#creating-a-linear-regression-model" id="toc-creating-a-linear-regression-model" class="nav-link" data-scroll-target="#creating-a-linear-regression-model">Creating a Linear Regression Model</a></li>
  </ul></li>
  <li><a href="#moran-i-calculation" id="toc-moran-i-calculation" class="nav-link" data-scroll-target="#moran-i-calculation">Moran I Calculation</a>
  <ul class="collapse">
  <li><a href="#calculating-nearest-neighbour" id="toc-calculating-nearest-neighbour" class="nav-link" data-scroll-target="#calculating-nearest-neighbour">Calculating Nearest Neighbour</a></li>
  <li><a href="#calculating-neighborhood-matrix" id="toc-calculating-neighborhood-matrix" class="nav-link" data-scroll-target="#calculating-neighborhood-matrix">Calculating Neighborhood Matrix</a></li>
  <li><a href="#calculating-moran-i" id="toc-calculating-moran-i" class="nav-link" data-scroll-target="#calculating-moran-i">Calculating Moran I</a></li>
  </ul></li>
  <li><a href="#generating-geographically-weighted-regression" id="toc-generating-geographically-weighted-regression" class="nav-link" data-scroll-target="#generating-geographically-weighted-regression">Generating Geographically Weighted Regression</a>
  <ul class="collapse">
  <li><a href="#calculating-adaptive-bandwidth" id="toc-calculating-adaptive-bandwidth" class="nav-link" data-scroll-target="#calculating-adaptive-bandwidth">Calculating Adaptive Bandwidth</a></li>
  <li><a href="#building-gwr-model" id="toc-building-gwr-model" class="nav-link" data-scroll-target="#building-gwr-model">Building GWR Model</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project Data-preprocessing</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hao Xian, Wen Yang and Pierre Jean Michel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 11, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>We will first need to Pre processed all the information that we need.</p>
<section id="loading-the-packages" class="level1">
<h1>Loading the Packages</h1>
<p><strong>The R packages we’ll use for this analysis are:</strong></p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/sf/index.html"><strong>sf</strong></a>: used for importing, managing, and processing spatial data</p></li>
<li><p><a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>: a collection of packages for data science tasks</p>
<ul>
<li><p><strong>readr</strong> for importing delimited files (.csv)</p></li>
<li><p><strong>tidyr</strong> for manipulating and tidying data</p></li>
<li><p><strong>dplyr</strong> for wrangling and transforming data</p></li>
<li><p><strong>ggplot2</strong> for visualising data</p></li>
</ul></li>
<li><p><a href="https://cran.r-project.org/web/packages/tmap/index.html"><strong>tmap</strong></a>: used for creating thematic maps, such as choropleth and bubble maps</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/spdep/index.html"><strong>spdep</strong></a>: used to create spatial weights matrix objects, global and local spatial autocorrelation statistics and related calculations (e.g.&nbsp;spatially lag attributes)</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/onemapsgapi/index.html"><strong>onemapsgapi</strong></a>: used to query Singapore-specific spatial data, alongside additional functionalities.</p></li>
<li><p>[<strong>httr</strong>]((https://cran.r-project.org/web/packages/httr/)<strong>:</strong> used to make API calls, such as a GET request</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/units/index.html"><strong>units</strong></a>: used to for manipulating numeric vectors that have physical measurement units associated with them</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/matrixStats/index.html"><strong>matrixStats</strong></a>: a set of high-performing functions for operating on rows and columns of matrices</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html"><strong>jsonlite</strong></a>: a JSON parser that can convert from JSON to the appropraite R data types</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/rgdal/index.html"><strong>rgdal</strong></a><strong>:</strong> provides bindings to the ‘Geospatial’ Data Abstraction Library</p></li>
</ul>
<p><strong>In addition, these R packages are specific to building + visualising hedonic pricing models:</strong></p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/olsrr/index.html"><strong>olsrr</strong></a>: used for building least squares regression models</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html"><strong>coorplot</strong></a> + <a href="https://cran.r-project.org/web/packages/ggpubr/index.html"><strong>ggpubr</strong></a>: both are used for multivariate data visualisation &amp; analysis</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/GWmodel/index.html"><strong>GWmodel</strong></a>: provides a collection of localised spatial statistical methods, such as summary statistics, principal components analysis, discriminant analysis and various forms of GW regression</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/SpatialML/index.html"><strong>SpatialML</strong></a><strong>:</strong> Implements a spatial extension of the random forest algorithm</p></li>
</ul>
<p><strong>Lastly, here are the extra R packages that aren’t necessary for the analysis itself, but help us go the extra mile with visualisations and presentation of our analysis:</strong></p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/devtools/index.html"><strong>devtools</strong></a>: used for installing any R packages which is not available in RCRAN. In this context, it’ll be used to download the <a href="https://pkg.garrickadenbuie.com/xaringanExtra/#/"><strong>xaringanExtra</strong></a> package for <a href="https://pkg.garrickadenbuie.com/xaringanExtra/#/panelset">panelsets</a></p></li>
<li><p><a href="https://haozhu233.github.io/kableExtra/"><strong>kableExtra</strong></a>: an extension of kable, used for table customisation</p></li>
<li><p><a href="https://plotly.com/r/"><strong>plotly</strong></a>: used for creating interactive web graphics, and can be used in conjunction with ggplot2 with the <code>ggplotly()</code> function</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/ggthemes/index.html"><strong>ggthemes</strong></a>: an extension of ggplot2, with more advanced themes for plotting</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, tidyverse, tmap, spdep, httr,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>             onemapsgapi, units, matrixStats, readxl, jsonlite,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>             olsrr, corrplot, ggpubr, GWmodel, SpatialML, tidymodels, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>             devtools, kableExtra, plotly, ggthemes, onemapsgapi, rgdal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-data" class="level1">
<h1>The Data</h1>
<section id="list-of-data" class="level2">
<h2 class="anchored" data-anchor-id="list-of-data">List of Data</h2>
<p>Note that this list is not exhaustive and if you find other point data you can add them as well.</p>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Name</th>
<th>Format</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Aspatial</td>
<td>Resale Flat Price</td>
<td>.csv</td>
<td><a href="https://data.gov.sg/dataset/resale-flat-prices">data.gov.sg</a></td>
</tr>
<tr class="even">
<td>Geospatial</td>
<td>Singapore National Boundary</td>
<td>.shp</td>
<td><a href="https://data.gov.sg/dataset/national-map-polygon">data.gov.sg</a></td>
</tr>
<tr class="odd">
<td>Geospatial</td>
<td>Master Plan 2019 Subzone Boundary (Web)</td>
<td>.shp</td>
<td>Prof Kam</td>
</tr>
<tr class="even">
<td>Geospatial</td>
<td>MRT Exit Point</td>
<td>.shp</td>
<td><a href="https://datamall.lta.gov.sg/content/datamall/en/search_datasets.html?searchText=train">LTA Data Mall</a></td>
</tr>
<tr class="odd">
<td>Geospatial</td>
<td>Bus Stop Locations Aug 2023</td>
<td>.shp</td>
<td><a href="https://datamall.lta.gov.sg/content/datamall/en/search_datasets.html?searchText=bus%20stop">LTA Data Mall</a></td>
</tr>
<tr class="even">
<td>Geospatial - Extracted</td>
<td>Childcare Services</td>
<td>.shp</td>
<td><a href="https://www.onemap.gov.sg/docs/">OneMap API</a></td>
</tr>
<tr class="odd">
<td>Geospatial - Extracted</td>
<td>Eldercare Services</td>
<td>.shp</td>
<td><a href="https://www.onemap.gov.sg/docs/">OneMap API</a></td>
</tr>
<tr class="even">
<td>Geospatial - Extracted</td>
<td>Hawker Centres</td>
<td>.shp</td>
<td><a href="https://www.onemap.gov.sg/docs/">OneMap API</a></td>
</tr>
<tr class="odd">
<td>Geospatial - Extracted</td>
<td>Kindergartens</td>
<td>.shp</td>
<td><a href="https://www.onemap.gov.sg/docs/">OneMap API</a></td>
</tr>
<tr class="even">
<td>Geospatial - Extracted</td>
<td>Parks</td>
<td>.shp</td>
<td><a href="https://www.onemap.gov.sg/docs/">OneMap API</a></td>
</tr>
<tr class="odd">
<td>Geospatial - Extracted</td>
<td>Supermarkets</td>
<td>.kml</td>
<td><a href="https://www.onemap.gov.sg/main/v2/essentialamenities">OneMap API</a></td>
</tr>
<tr class="even">
<td>Geospatial - Extracted</td>
<td>Primary Schools</td>
<td>.pdf</td>
<td><a href="https://www.moe.gov.sg/about-us/organisation-structure/sd/school-clusters">MOE Website</a></td>
</tr>
<tr class="odd">
<td>Geospatial - Selfsourced</td>
<td>List of Shopping Mall</td>
<td>.html</td>
<td><a href="https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore">Wikipedia</a></td>
</tr>
<tr class="even">
<td>Geospatial - Selfsourced</td>
<td>Pharmacy</td>
<td>.kml</td>
<td><a href="https://www.onemap.gov.sg/main/v2/essentialamenities">OneMap API</a></td>
</tr>
<tr class="odd">
<td>Geospatial - Selfsourced</td>
<td>Integrated Screening Programme (ISP) Clinics</td>
<td>.kml</td>
<td><a href="https://www.onemap.gov.sg/main/v2/essentialamenities">OneMap API</a></td>
</tr>
<tr class="even">
<td>Geospatial - Selfsourced</td>
<td>Libraries</td>
<td>.kml</td>
<td><a href="https://www.onemap.gov.sg/main/v2/essentialamenities">OneMap API</a></td>
</tr>
<tr class="odd">
<td>Geospatial - Selfsourced</td>
<td>Tourist</td>
<td>.kml</td>
<td><a href="https://www.onemap.gov.sg/main/v2/essentialamenities">OneMap API</a></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="preparing-the-aspatial-data" class="level1">
<h1>Preparing the Aspatial Data</h1>
<section id="importing-the-resale-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-resale-data">Importing the Resale Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/resale-flat-prices.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(resale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Taking a look at the data we have noticed that the data set contains 11 columns with 148576 observations. They have the following columns: <strong><em>months, town, flat_type, block, street_name, storey_range, floor_area_sqm, flat_model, remaining_lease, resale_price.</em></strong> We are only interested in the following period from: <em>1st January 2021 to 31st December 2022</em> and <em>January 2023 to February 2022</em>.</p>
<section id="filtering-the-aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="filtering-the-aspatial-data">Filtering the Aspatial Data</h3>
<p>We are making use of the filter function from the dplyr package to help us filter out the data. Find out more <a href="https://dplyr.tidyverse.org/reference/filter.html">here</a>. As there is more steps to be done on the aspatial data before it can be used for geographically weighted regression, we will split the data set into the period: 1<em>st January 2021 to February 2022</em>, for now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span>  <span class="fu">filter</span>(resale,flat_type <span class="sc">==</span> <span class="st">"4 ROOM"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2021-01"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2023-02"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have split it, we can make use of the unique function of Base R to ensure that all the data extracted out are correct. Find out more <a href="https://rdrr.io/r/base/unique.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(resale_flat_full<span class="sc">$</span>flat_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(resale_flat_full<span class="sc">$</span>month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the result above, we can confirm that the data for data set is extracted correctly.</p>
</section>
</section>
<section id="transforming-the-resale-data" class="level2">
<h2 class="anchored" data-anchor-id="transforming-the-resale-data">Transforming the Resale Data</h2>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following steps are made with reference to: Take Home Exercise 3 done by: NOR AISYAH BINTE AJIT. Check out her work <a href="https://aisyahajit2018-is415.netlify.app/posts/2021-11-07-take-home-exercise-3/">here</a>.</p>
</div>
</div>
<p>Now that we have correctly filter out the dataset that we wish to use, we are left with another problem. Lets have a look at our data as an example for me to better illustrate the problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_flat_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In our analysis, we are looking at the following key_factors:</p>
<ul>
<li><p>Area of the unit</p></li>
<li><p>Floor level</p></li>
<li><p>Remaining lease</p></li>
<li><p>Age of the unit</p></li>
</ul>
<p>With regards to the key factor. Notice how there are 4 key issues that we need to addressed:</p>
<ol type="1">
<li><p><strong>No geospatial data:</strong> There is no geospatial data for us to plot out the points. This is worrying as the geospatial data is needed for us to perform geographically weighted regression. Fortunately, the data frame provided 2 columns that are critical in retrieving the coordinates of the flat, however it is found in <strong><em>2 different columns:</em></strong> <strong>block, street_name</strong>. We would need to concatenate them together into to search for their coordinates.</p></li>
<li><p><strong>remaining_lease is recorded as a string:</strong> The remaining leases data is found as a string, when it should be an continuos variable. It is current written as a string currently, which will be treated as a categorical data instead, as such we would need to convert it into the correct format first.</p></li>
<li><p><strong>storey_range is given as a range:</strong> In our dataset, the floor of the exact unique is not given, but rather a range is given this could be a huge potential issue as this would mean thatthe data will treated as a categorical data. We would need to convert it into the correct format first</p></li>
<li><p><strong>No age</strong>: There is no age in our dataset, which would mean that we would need to solve this issue as well.</p></li>
</ol>
<section id="retrieving-postal-codes-and-coordinates-of-the-address" class="level3">
<h3 class="anchored" data-anchor-id="retrieving-postal-codes-and-coordinates-of-the-address">Retrieving Postal Codes and Coordinates of the address</h3>
<p>As mentioned before, one of the key issues that we would need to perform is to retrieve all the relevant data such as postal code and coordinates of the address that is needed for later analysis.</p>
<p>The steps are as followed:</p>
<ol type="1">
<li><p>Combining Block and Street Name to form an address</p></li>
<li><p>Filtering out Unique Address</p></li>
<li><p>Retrieving coordinates from OneMap.API</p></li>
<li><p>Inspecting the Result and Fixing the Issues</p></li>
</ol>
<section id="step-1-combining-block-and-street-name-to-form-an-address" class="level4">
<h4 class="anchored" data-anchor-id="step-1-combining-block-and-street-name-to-form-an-address">Step 1: Combining Block and Street Name to form an address</h4>
<p>In this step, we will be combining the street_name and block to form an address.</p>
<p>We can make use of the <code>paste()</code> function from base R to concatenate the two data together. Find out more <a href="https://rdrr.io/r/base/paste.html">here</a>.</p>
<p>Afterwards, we will placed the data in a new columns called address in the dataframe by using the <code>mutate()</code> function from dplyr. Find out more about <a href="https://dplyr.tidyverse.org/reference/mutate.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">address =</span> <span class="fu">paste</span>(block,street_name))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_flat_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-filtering-out-unique-address." class="level4">
<h4 class="anchored" data-anchor-id="step-2-filtering-out-unique-address.">Step 2: Filtering out Unique Address.</h4>
<p>This step is performed in order to minimize the amount of API Call that we need to perform. Furthermore, this also makes it easier for us to see which of the address will result in an error.</p>
<p>We will first get the unique address out first before sorting the data. This can be done with the <code>sort()</code> from base R. Find out more <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/sort">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>add_list <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_flat_full<span class="sc">$</span>address))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3-retrieiving-coordinates-from-onemap-api" class="level4">
<h4 class="anchored" data-anchor-id="step-3-retrieiving-coordinates-from-onemap-api">Step 3: Retrieiving Coordinates from OneMap API</h4>
<p>To retrieve the coordinates from OneMap API, it will be easier to create a function to retrieve all the coordinate instead. To do so, lets take a deep dive into the OneMap API. Documentation can be found <a href="https://www.onemap.gov.sg/docs/#onemap-rest-apis">here</a>. In this case, we will be making use of the OneMap API search API to retrieve the necessary coordinates.</p>
<p>According to the documentation, the request requires the following.</p>
<ul>
<li><p><strong>searchVal:</strong> Keywords entered by user that is used to filter out the results.</p></li>
<li><p><strong>returnGeom {Y/N}:</strong> Checks if user wants to return the geometry.</p></li>
<li><p><strong>getAddrDetails {Y/N}</strong>: Checks if user wants to return address details for a point.</p></li>
<li><p><strong>pageNum</strong>: Specifies the page to retrieve your search results from. <em>This is optional (We will not be using this in this case)</em></p></li>
</ul>
<p>A provided example link would be something like this: <em>https://developers.onemap.sg/commonapi/search?searchVal=revenue&amp;returnGeom=Y&amp;getAddrDetails=Y&amp;pageNum=1</em></p>
<p>This will be the following response <strong><em>(Taken from OneMap API)</em></strong>:</p>
<p><img src="images/image-2146457878.png" class="img-fluid"></p>
<p>We are only interested in the LATITUDE and LONGITUDE data in this case.</p>
<p>Now that we understand the API better, we will now create a function that will help us sort through all the data. The following code chunk below does a number of critical steps:</p>
<ol type="1">
<li><p>We will create a data frame called postal_coords that will store all the data frame.</p></li>
<li><p>We will make use of the <code>GET()</code> function from httr package to make a get request call. Find out more <a href="https://httr.r-lib.org/reference/GET.html">here</a>.</p></li>
<li><p>We will create a data frame called new role to store all the coordinates</p></li>
<li><p>We also need to check the number of responses returned and append to the main data frame accordingly. This is because there are a few conditions to take note of</p>
<ul>
<li><p>The number of results can be greater than one or none at all. (<em>indicated by found</em> in the JSON).</p></li>
<li><p>The results returned can have no postal code (<em>which we will not consider as valid)</em></p></li>
<li><p>We will take the first result with a valid postal code as the correct coordinates.</p></li>
</ul></li>
<li><p>Lastly, we will append the returned response (<strong>new_row</strong>) with the necessary fields to the main dataframe (<strong>postal_coords</strong>) using <code>rbind()</code> function of base R package. Find out more <a href="https://rdrr.io/r/base/cbind.html">here</a>.</p></li>
</ol>
<p>All of this can be found in the code chunk below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(add_list){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame to store all retrieved coordinates</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  postal_coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> add_list){</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(i)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">'https://developers.onemap.sg/commonapi/search?'</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">query=</span><span class="fu">list</span>(<span class="at">searchVal=</span>i,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">returnGeom=</span><span class="st">'Y'</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">getAddrDetails=</span><span class="st">'Y'</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(r<span class="sc">$</span>content))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    found <span class="ot">&lt;-</span> data<span class="sc">$</span>found</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> data<span class="sc">$</span>results</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new data frame for each address</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If single result, append </span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (found <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>      postal <span class="ot">&lt;-</span> res<span class="sc">$</span>POSTAL </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> res<span class="sc">$</span>LATITUDE</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>      lng <span class="ot">&lt;-</span> res<span class="sc">$</span>LONGITUDE</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> postal, <span class="at">latitude =</span> lat, <span class="at">longitude =</span> lng)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If multiple results, drop NIL and append top 1</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (found <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove those with NIL as postal</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      res_sub <span class="ot">&lt;-</span> res[res<span class="sc">$</span>POSTAL <span class="sc">!=</span> <span class="st">"NIL"</span>, ]</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set as NA first if no Postal</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(res_sub) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>          new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> <span class="cn">NA</span>, <span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        top1 <span class="ot">&lt;-</span> <span class="fu">head</span>(res_sub, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        postal <span class="ot">&lt;-</span> top1<span class="sc">$</span>POSTAL </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        lat <span class="ot">&lt;-</span> top1<span class="sc">$</span>LATITUDE</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        lng <span class="ot">&lt;-</span> top1<span class="sc">$</span>LONGITUDE</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> postal, <span class="at">latitude =</span> lat, <span class="at">longitude =</span> lng)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> <span class="cn">NA</span>, <span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the row</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    postal_coords <span class="ot">&lt;-</span> <span class="fu">rbind</span>(postal_coords, new_row)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(postal_coords)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the function define we can call the function to generate out the data frame of the postal codes.</p>
<p>Please note that this function does take some time to run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(add_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-inspecting-the-result-and-fixing-the-issues" class="level4">
<h4 class="anchored" data-anchor-id="step-4-inspecting-the-result-and-fixing-the-issues">Step 4: Inspecting the Result and Fixing the Issues</h4>
<p>Remember all the issues that we can face when making the api call, we would need to check to make sure that all the data is accounted for.</p>
<p>We can make use of the <code>is.na()</code> function to check which street address contains any NA values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>coords[(<span class="fu">is.na</span>(coords<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(coords<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(coords<span class="sc">$</span>longitude) <span class="sc">|</span> coords<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Based on the data frame above, we have noticed that there seems to be 2 address with no postal code</p>
<ul>
<li><p>215 CHOA CHU KANG</p></li>
<li><p>216 CHOA CHU KANG</p></li>
</ul>
<p>When searching directly with OneMap API instead, we found that OneMap API classified them as the same building instead with the results being <strong><em>“BLK 216 AND 215 CHOA CHU KANG CENTRAL”.</em></strong> Furthermore a brief check on the website: property indicates the postal code as</p>
<ul>
<li><p><a href="https://www.propertyguru.com.sg/singapore-property-listing/hdb/choa-chu-kang/choa-chu-kang-central_104043/215">680215</a></p></li>
<li><p><a href="https://www.propertyguru.com.sg/singapore-property-listing/hdb/choa-chu-kang/choa-chu-kang-central_104043/216">680216</a></p></li>
</ul>
<p>We shall proceed with keeping them as the same as there is the latitude and longitude data.</p>
</section>
</section>
<section id="transforming-remaining-lease" class="level3">
<h3 class="anchored" data-anchor-id="transforming-remaining-lease">Transforming Remaining Lease</h3>
<p>In this section, we will be transforming the remaining lease into an integer.</p>
<p>First, we will split the remaining lease into years and months columns for calculation. To do so, we will make use of <code>str_sub()</code> function from tidyverse. Find out more <a href="https://stringr.tidyverse.org/reference/str_sub.html">here</a>.</p>
<p>we will convert the string into an integer using the <code>as.integer()</code> function from base R. Find out more <a href="https://rdrr.io/r/base/integer.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">remaining_lease_yr =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">0</span>, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">remaining_lease_mth =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">9</span>, <span class="dv">11</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will then convert the NA values of the remaining_lease_mth columns into 0. We can make use of the <code>is.na()</code> function from base R. Find out more <a href="https://rdrr.io/r/base/NA.html">here</a>.</p>
<p>Followed by changing the remaining_lease_yr into months.</p>
<p>Finally, we can sum the two columns together with <code>rowSums()</code> function from base R. Find out more <a href="https://rdrr.io/r/base/colSums.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full<span class="sc">$</span>remaining_lease_mth[<span class="fu">is.na</span>(resale_flat_full<span class="sc">$</span>remaining_lease_mth)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>resale_flat_full<span class="sc">$</span>remaining_lease_yr <span class="ot">&lt;-</span> resale_flat_full<span class="sc">$</span>remaining_lease_yr <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">remaining_lease_mths =</span> <span class="fu">rowSums</span>(resale_flat_full[, <span class="fu">c</span>(<span class="st">"remaining_lease_yr"</span>, <span class="st">"remaining_lease_mth"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transforming-storey-range" class="level3">
<h3 class="anchored" data-anchor-id="transforming-storey-range">Transforming Storey Range</h3>
<p>Categorical variables require special attention in regression analysis because, unlike continuous variables, they <em>cannot</em> be entered into the regression equation just as they are. A method we can used to convert categorical variables into continuous variable is called “treatment” coding, or “dummy” coding. This method involve converting the categorical variable into a reference number.</p>
<p>However, we must understand that <strong><em>storey range</em></strong> is an ordinal data, in other words, each categorical has an order, or in this case, low to high. Using a dummy variable might not make as much sense in this case. Hence, we will assign a higher value to higher floors. The reasoning behind it is that a higher floor offers more privacy, better security and lower noise pollution due to the high height.</p>
<p>We will first create a dataframe to store all the unique storey range and at the same time sort them. After they are sorted we will create a list of encoding based on the unique values then merging them to form a data frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>storeys <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_flat_full<span class="sc">$</span>storey_range))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>storey_order <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(storeys)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>storey_range_order <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(storeys, storey_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(storey_range_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the above results, we can see that:</p>
<ul>
<li><p>01 TO 03 is assigned the value: 1</p></li>
<li><p>04 TO 06 is assigned the value: 2</p></li>
<li><p>07 TO 09 is assigned the value: 3</p></li>
<li><p>10 TO 12 is assigned the value: 4</p></li>
<li><p>13 TO 15 is assigned the value: 5</p></li>
<li><p>16 TO 18 is assigned the value: 6</p></li>
</ul>
<p>Hence, the storey range are in the correct order</p>
</section>
<section id="transforming-age" class="level3">
<h3 class="anchored" data-anchor-id="transforming-age">Transforming Age</h3>
<p>Age is one of the key factors that we are using in our analysis. However, there is no direct reference to age of the HDB. One method we can use is to infer the age of the building based on the remaining lease. It is well known that Singapore HDB are leased to us for 99 years as such we can calculate the age based on the difference between the total lease and remaining lease.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">age =</span> <span class="dv">99</span> <span class="sc">*</span> <span class="dv">12</span> <span class="sc">-</span> resale_flat_full<span class="sc">$</span>remaining_lease_mths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_flat_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-all-the-data-and-storing-as-rds" class="level3">
<h3 class="anchored" data-anchor-id="combining-all-the-data-and-storing-as-rds">Combining all the data and storing as RDS</h3>
<p>We will now combine all the relevant fields to a data frame using <code>left_join()</code> function of dplyr package. Find out more <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> <span class="fu">left_join</span>(resale_flat_full, storey_range_order, <span class="at">by=</span> <span class="fu">c</span>(<span class="st">"storey_range"</span> <span class="ot">=</span> <span class="st">"storeys"</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>rs_coords <span class="ot">&lt;-</span> <span class="fu">left_join</span>(resale_flat_full, coords, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'address'</span> <span class="ot">=</span> <span class="st">'address'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then store the data frame into a rds for use later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>rs_coords_rds <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(rs_coords, <span class="st">"data/aspatial/rds/rs_coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="viewing-rds-data" class="level2">
<h2 class="anchored" data-anchor-id="viewing-rds-data">Viewing RDS Data</h2>
<section id="reading-rds" class="level3">
<h3 class="anchored" data-anchor-id="reading-rds">Reading RDS</h3>
<p>Instead of performing all the steps above again, once you save the data frame in a rds format, you can read the rds format again. Notice how the data frame is saved exactly as it is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rs_coords <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/aspatial/rds/rs_coords.rds"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rs_coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="converting-to-sf-object" class="level3">
<h3 class="anchored" data-anchor-id="converting-to-sf-object">Converting to Sf Object</h3>
<p>Since the coordinate columns are Latitude &amp; Longitude which are in decimal degrees, the projected CRS will be WGS84. We will need to assign them the respective EPSG code 4326 first before transforming it to 3414 which is the EPSG code for SVY21.</p>
<p>We will first use the <code>st_as_sf()</code> function of sf package to convert the data frame into sf object. Find out more <a href="https://www.rdocumentation.org/packages/sf/versions/1.0-9/topics/st_as_sf">here</a>.</p>
<p>Followed by the <code>st_transform()</code> function of sf package to transform the coordinates of the sf object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rs_coords_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(rs_coords,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"latitude"</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>rs_coords_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-for-invalid-geometries" class="level3">
<h3 class="anchored" data-anchor-id="checking-for-invalid-geometries">Checking for invalid geometries</h3>
<p>The step below is not exactly mandatory, but it is good to check if the sf object is valid or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(rs_coords_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-the-hdb-resale-points" class="level3">
<h3 class="anchored" data-anchor-id="plotting-the-hdb-resale-points">Plotting the HDB Resale points</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(rs_coords_sf)<span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">0.02</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="preparing-the-locational-data" class="level1">
<h1>Preparing the Locational Data</h1>
<p>In this section, we will be retrieving all the other co location factors from the OneMap API.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following steps are made with reference to: Take Home Exercise 3 done by: MEGAN SIM TZE YEN. Check out her work <a href="https://is415-msty.netlify.app/posts/2021-10-25-take-home-exercise-3/#structural-factors">here</a>.</p>
</div>
</div>
<section id="extracting-the-data-from-onemap-api" class="level2">
<h2 class="anchored" data-anchor-id="extracting-the-data-from-onemap-api">Extracting the Data from OneMap API</h2>
<p>Before we do a deep dive into examining the data, the first step that we need to do first is to extract out all the relevant data that we need. But first we need to see what OneMap API allows us to extract first.</p>
<p>Before we start off, I will first be introducing to you the onemapsgapi package that we will be using. You can learn more about the package <a href="https://rdrr.io/cran/onemapsgapi/">here</a>. You will need to sign up for an account so that they will generate a unique token for you to use. I have already pre-loaded my token into a variable called <strong><em>token</em></strong>.</p>
<section id="step-1-searching-for-themes" class="level3">
<h3 class="anchored" data-anchor-id="step-1-searching-for-themes">Step 1: Searching for Themes</h3>
<p>The first step that we can do is to see what themes are available for us to use, with the code chunk below. In this case, we will be using the function <code>search_themes()</code> function to help us view all the available list. Find out more <a href="https://rdrr.io/cran/onemapsgapi/man/search_themes.html">here</a>.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Please replace token with the values of your own token.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>avail_themes <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>avail_themes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see there seems to be a huge amount of themes available for us to use, which in this case I am interested only in a few namely, <strong>Eldercare Services, Childcare Services, Hawker Centres, Parks, Kindergartens.</strong> As you have noticed, there seems to be some themes that have repeated themselves, we would need to do a deep dive to find out more about what each theme contains.</p>
</section>
<section id="step-2-a-closer-look-at-each-theme" class="level3">
<h3 class="anchored" data-anchor-id="step-2-a-closer-look-at-each-theme">Step 2: A Closer Look at each theme</h3>
<p>One ability of the <code>search_themes()</code> function is that you can make a query as well. This way there is no need to see all the other information that is not necessary for our evaluation.</p>
<p><u><strong>Eldercare</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>avail_themes_elder <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"elder"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>avail_themes_elder</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is only one available theme relating to Eldercare, so this theme will be use. The query is <code>eldercare</code></p>
<p><u><strong>Childcare</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>avail_themes_child <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"childcare"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>avail_themes_child</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is only one available theme relating to ChildCare, so this theme will be use. The query is <code>childcare</code></p>
<p><u><strong>Hawker Centres</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>avail_themes_hawker <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"hawker"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>avail_themes_hawker</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, there appears to be 3 different themes with the name “Hawker”. In this case, we can ignore the healthier_hawker_centres, as it category is in health rather than environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>hawkercentre_new <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"hawkercentre_new"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>hawkercentre <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, <span class="st">"hawkercentre"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hawkercentre_new)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hawkercentre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we were to compare to 2 data frame, both data set has the same number of observations, with the only difference being that hawkercentre_new theme has more variables as compared to that of the hawkercentre. However, the difference in variables does seems to add value to the data frame at all and will be drop as those variables are not essential. Using either of the themes should have be fine, but I will be making use of the former for this exercise.</p>
<p>The query picked is <code>hawkercentre_new</code></p>
<p><u><strong>Parks</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>avail_themes_parks <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"parks"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>avail_themes_parks </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Based on the dataframe, above there seems to be a total of 25 different themes that matches the name “parks”, however this is due to the fact that it is the result also returns the results from the “National Parks Boards”. There are two themes that stands out the most here: “Parks” and “NParks Parks and Nature Reserve”. If we were to look into their category we found that the former belongs to recreation, while the latter belongs to environment. Seeing as we’re trying to relate the locational factors to the pricing of resale housing units, it makes more sense to go with the former!</p>
<p>The query chosen is <code>nationalparks</code></p>
<p><u><strong>Kindergarten</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>avail_themes_kindergarten <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"kinder"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>avail_themes_kindergarten</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is only one available theme relating to Kindergartens, so this theme will be use. The query is <code>kindergartens</code></p>
<p><u><strong>Clinic</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>avail_themes_clinic <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"health"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>avail_themes_clinic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is only one available theme relating to Clinic, so this theme will be use. The query is <code>moh_isp_clinics</code></p>
<p>Another theme of interest could also be Pharmacy, so this theme will be use. The query is <code>registered_pharmacy</code></p>
<p><u><strong>Tourist</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>avail_themes_tourist <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"tourism"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>avail_themes_kindergarten</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is only one available theme relating to Tourism, so this theme will be use. The query is <code>tourism</code></p>
<p><u><strong>Libraries</strong></u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>avail_themes_libraries <span class="ot">&lt;-</span> <span class="fu">search_themes</span>(token, <span class="st">"libraries"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>avail_themes_libraries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is only one available theme relating to Tourism, so this theme will be use. The query is <code>libraries</code></p>
<p><u><strong>Others</strong></u></p>
<p>One thing to note is that we are no longer able to access some information that Megan has access to due to the update of the API such as the name of the primary school as well, which we will address in the other section.</p>
</section>
<section id="step-3-saving-the-data-into-a-data-frame" class="level3">
<h3 class="anchored" data-anchor-id="step-3-saving-the-data-into-a-data-frame">Step 3: Saving the Data into a data frame</h3>
<p>In order to facilitate in the retrieving of themes, I have created the following function to aid me in retrieving the themes and saving them as a data frame.</p>
<p>We will be making use of the <code>get_theme()</code> function from the onemapsgapi package to retrieve the relevant and output it in a tibble frame. Read more <a href="https://cran.r-project.org/web/packages/onemapsgapi/vignettes/onemapsgapi_vignette.html">here</a>.</p>
<p>Afterwards, we will convert the tibble to simple features dataframe. All the themes for this project use Lat and Lng as the latitude and longitude respectively, and our project coordinates system should be in the WGS84 system, aka ESPG code 4326.</p>
<p>To ensure that we can access the data again, we will save it into asf into a shapefile, which we can do with <code>st_write()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>save_theme_sf <span class="ot">&lt;-</span> <span class="cf">function</span>(themename){</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  themetibble <span class="ot">&lt;-</span> <span class="fu">get_theme</span>(token, themename) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"NAME"</span>, <span class="st">"Lat"</span>, <span class="st">"Lng"</span>) )</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  themesf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(themetibble, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Lng"</span>, <span class="st">"Lat"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  themename_file <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"data/extracted/"</span>, themename, <span class="st">".shp"</span>, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_write</span>(themesf, themename_file)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"eldercare"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"childcare"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"hawkercentre_new"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"nationalparks"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"kindergartens"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"moh_isp_clinics"</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"registered_pharmacy"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"libraries"</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">save_theme_sf</span>(<span class="st">"tourism"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="extracting-the-other-data" class="level2">
<h2 class="anchored" data-anchor-id="extracting-the-other-data">Extracting the Other Data</h2>
<p>Now that we have handled those data, one issue that we have face is that there is no data for most the Shopping Mall or Primary School.</p>
<p><u><strong>Shopping Mall Data</strong></u></p>
<p>Unlike Megan’s Time where both Shopping Mall Data can be found in OneMap API, we need will need to make to do with the list from Wikipedia, which might not necessary be the most accurate, however, it appears to be the best list of data that we have.</p>
<p>You can find the link <a href="https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore">here</a>. <code>https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore</code></p>
<p>I have extracted the all the data from the wikipedia and clean it up manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>shopping_mall_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"100 AM"</span>,<span class="st">"313@Somerset"</span>,<span class="st">"Aperia"</span>,<span class="st">"Balestier Hill Shopping Centre"</span>,<span class="st">"Bugis Cube"</span>,<span class="st">"Bugis Junction"</span>,<span class="st">"Bugis+"</span>,<span class="st">"Capitol Piazza"</span>,<span class="st">"Cathay Cineleisure Orchard"</span>,<span class="st">"Clarke Quay Central"</span>,<span class="st">"The Centrepoint"</span>,<span class="st">"City Square Mall"</span>,<span class="st">"City Gate Mall"</span>,<span class="st">"CityLink Mall"</span>,<span class="st">"Duo"</span>,<span class="st">"Far East Plaza"</span>,<span class="st">"Funan"</span>,<span class="st">"Great World City"</span>,<span class="st">"HDB Hub"</span>,<span class="st">"Holland Village Shopping Mall"</span>,<span class="st">"ION Orchard"</span>,<span class="st">"Junction 8"</span>,<span class="st">"Knightsbridge"</span>,<span class="st">"Liat Towers"</span>,<span class="st">"Lucky Plaza"</span>,<span class="st">"Marina Bay Sands"</span>,<span class="st">"The Shoppes at Marina Bay Sands"</span>,<span class="st">"Marina Bay Link Mall"</span>,<span class="st">"Marina Square"</span>,<span class="st">"Millenia Walk"</span>,<span class="st">"Mustafa Shopping Centre"</span>,<span class="st">"Ngee Ann City"</span>,<span class="st">"Orchard Central"</span>,<span class="st">"Orchard Gateway"</span>,<span class="st">"Orchard Plaza"</span>,<span class="st">"Midpoint Orchard"</span>,<span class="st">"Palais Renaissance"</span>,<span class="st">"People's Park Centre"</span>,<span class="st">"People's Park Complex"</span>,<span class="st">"Plaza Singapura"</span>,<span class="st">"PoMo"</span>,<span class="st">"Raffles City"</span>,<span class="st">"Scotts Square"</span>,<span class="st">"Shaw House and Centre"</span>,<span class="st">"Sim Lim Square"</span>,<span class="st">"Singapore Shopping Centre"</span>,<span class="st">"The South Beach"</span>,<span class="st">"Square 2"</span>,<span class="st">"Sunshine Plaza"</span>,<span class="st">"Suntec City"</span>,<span class="st">"Tanglin Mall"</span>,<span class="st">"Tanjong Pagar Centre"</span>,<span class="st">"Tekka Centre"</span>,<span class="st">"The Adelphi"</span>,<span class="st">"The Paragon"</span>,<span class="st">"Tiong Bahru Plaza"</span>,<span class="st">"The Poiz"</span>,<span class="st">"Thomson Plaza"</span>,<span class="st">"United Square"</span>,<span class="st">"Thomson V"</span>,<span class="st">"Velocity@Novena Square"</span>,<span class="st">"Wheelock Place"</span>,<span class="st">"Wisma Atria"</span>,<span class="st">"Zhongshan Mall"</span>,<span class="st">"Bedok Mall"</span>,<span class="st">"Century Square"</span>,<span class="st">"Our Tampines Hub"</span>,<span class="st">"Changi City Point"</span>,<span class="st">"Downtown East"</span>,<span class="st">"Djitsun Mall Bedok"</span>,<span class="st">"Eastpoint Mall"</span>,<span class="st">"Jewel Changi Airport"</span>,<span class="st">"KINEX"</span>,<span class="st">"Katong Shopping Centre"</span>,<span class="st">"Katong Square"</span>,<span class="st">"Kallang Wave Mall"</span>,<span class="st">"Leisure Park Kallang"</span>,<span class="st">"i12 Katong"</span>,<span class="st">"Parkway Parade"</span>,<span class="st">"Paya Lebar Square"</span>,<span class="st">"Paya Lebar Quarter"</span>,<span class="st">"Roxy Square"</span>,<span class="st">"Singpost Centre"</span>,<span class="st">"Tampines 1"</span>,<span class="st">"Tampines Mall"</span>,<span class="st">"White Sands"</span>,<span class="st">"City Plaza"</span>,<span class="st">"Elias Mall"</span>,<span class="st">"Loyang Point"</span>,<span class="st">"888 Plaza"</span>,<span class="st">"Admiralty Place"</span>,<span class="st">"AMK Hub"</span>,<span class="st">"Canberra Plaza"</span>,<span class="st">"Causeway Point"</span>,<span class="st">"Woodlands Civic Centre"</span>,<span class="st">"Broadway Plaza"</span>,<span class="st">"Djitsun Mall"</span>,<span class="st">"Jubilee Square"</span>,<span class="st">"Junction 8"</span>,<span class="st">"Junction Nine"</span>,<span class="st">"Marsiling Mall"</span>,<span class="st">"Northpoint City"</span>,<span class="st">"Sembawang Shopping Centre"</span>,<span class="st">"Sun Plaza"</span>,<span class="st">"Vista Point"</span>,<span class="st">"Wisteria Mall"</span>,<span class="st">"Woodlands Mart"</span>,<span class="st">"Woodlands North Plaza"</span>,<span class="st">"Waterway Point"</span>,<span class="st">"Compass One"</span>,<span class="st">"Hougang Mall"</span>,<span class="st">"Heartland Mall"</span>,<span class="st">"NEX"</span>,<span class="st">"Buangkok Square"</span>,<span class="st">"Greenwich V"</span>,<span class="st">"Hougang 1"</span>,<span class="st">"Hougang Green Shopping Mall"</span>,<span class="st">"Hougang Rivercourt"</span>,<span class="st">"myVillage At Serangoon Garden"</span>,<span class="st">"Northshore Plaza"</span>,<span class="st">"Oasis Terraces"</span>,<span class="st">"Punggol Plaza"</span>,<span class="st">"Rivervale Mall"</span>,<span class="st">"Rivervale Plaza"</span>,<span class="st">"The Seletar Mall"</span>,<span class="st">"Upper Serangoon Shopping Centre"</span>,<span class="st">"Beauty World Centre"</span>,<span class="st">"Beauty World Plaza"</span>,<span class="st">"Bukit Panjang Plaza"</span>,<span class="st">"Bukit Timah Plaza"</span>,<span class="st">"Fajar Shopping Centre"</span>,<span class="st">"Greenridge Shopping Centre"</span>,<span class="st">"Hillion Mall"</span>,<span class="st">"HillV2"</span>,<span class="st">"Junction 10"</span>,<span class="st">"Keat Hong Shopping Centre"</span>,<span class="st">"Limbang Shopping Centre"</span>,<span class="st">"Lot One"</span>,<span class="st">"Rail Mall"</span>,<span class="st">"Sunshine Place"</span>,<span class="st">"Teck Whye Shopping Centre"</span>,<span class="st">"West Mall"</span>,<span class="st">"Yew Tee Point"</span>,<span class="st">"Yew Tee Square"</span>,<span class="st">"VivoCity"</span>,<span class="st">"HarbourFront Centre"</span>,<span class="st">"Alexandra Retail Centre"</span>,<span class="st">"321 Clementi"</span>,<span class="st">"The Clementi Mall"</span>,<span class="st">"IMM"</span>,<span class="st">"JCube"</span>,<span class="st">"Jem"</span>,<span class="st">"Westgate"</span>,<span class="st">"Jurong Point"</span>,<span class="st">"Pioneer Mall"</span>,<span class="st">"The Star Vista"</span>,<span class="st">"Alexandra Central"</span>,<span class="st">"Anchorpoint"</span>,<span class="st">"OD Mall"</span>,<span class="st">"Boon Lay Shopping Centre"</span>,<span class="st">"Grantral Mall"</span>,<span class="st">"Fairprice Hub"</span>,<span class="st">"Gek Poh Shopping Centre"</span>,<span class="st">"Rochester Mall"</span>,<span class="st">"Taman Jurong Shopping Centre"</span>,<span class="st">"West Coast Plaza"</span>,<span class="st">"Queensway Shopping Centre"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember the function that we have created to retrieve the hdb, we can make use of it here as well to find their coordinates.</p>
<p>Note that this function does take some time to run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>shop_coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(shopping_mall_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>shop_coords</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now then we can check which Mall does not have the necessary data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>shop_coords[(<span class="fu">is.na</span>(shop_coords<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(shop_coords<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(shop_coords<span class="sc">$</span>longitude) <span class="sc">|</span> shop_coords<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the results above, we can see that there are 7 addresses that does not contain any information at all:</p>
<ul>
<li><p>Clarke Quay Central</p></li>
<li><p>City Gate Mall</p></li>
<li><p>Holland Village Shopping Mall</p></li>
<li><p>Mustafa Shopping Centre</p></li>
<li><p>PoMo</p></li>
<li><p>Shaw House and Centre</p></li>
<li><p>OD Mall</p></li>
</ul>
<p>I research deeper into the situation and found reverse search the malls to find their Postal Code, afterwards I will search out the name based on the One Map API and found the following:</p>
<ul>
<li><p>Clarke Quay Central is called <code>The Central</code></p></li>
<li><p>City Gate Mall is called <code>City Gate</code></p></li>
<li><p>Holland Village Shopping Mall is called <code>Holland Road Shopping Centre</code></p></li>
<li><p>Mustafa Shopping Centre is called <code>Mustafa Centre</code></p></li>
<li><p>PoMO is called <code>GR.ID</code></p></li>
<li><p>Shaw House and Centre is called <code>Shaw Centre</code></p></li>
<li><p>OD Mall is called <code>The GrandStand</code></p></li>
</ul>
<p>I will append the names in the list below as it is easier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>new_shopping_mall_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"100 AM"</span>,<span class="st">"313@Somerset"</span>,<span class="st">"Aperia"</span>,<span class="st">"Balestier Hill Shopping Centre"</span>,<span class="st">"Bugis Cube"</span>,<span class="st">"Bugis Junction"</span>,<span class="st">"Bugis+"</span>,<span class="st">"Capitol Piazza"</span>,<span class="st">"Cathay Cineleisure Orchard"</span>,<span class="st">"The Central"</span>,<span class="st">"The Centrepoint"</span>,<span class="st">"City Square Mall"</span>,<span class="st">"City Gate"</span>,<span class="st">"CityLink Mall"</span>,<span class="st">"Duo"</span>,<span class="st">"Far East Plaza"</span>,<span class="st">"Funan"</span>,<span class="st">"Great World City"</span>,<span class="st">"HDB Hub"</span>,<span class="st">"Holland Road Shopping Centre"</span>,<span class="st">"ION Orchard"</span>,<span class="st">"Junction 8"</span>,<span class="st">"Knightsbridge"</span>,<span class="st">"Liat Towers"</span>,<span class="st">"Lucky Plaza"</span>,<span class="st">"Marina Bay Sands"</span>,<span class="st">"The Shoppes at Marina Bay Sands"</span>,<span class="st">"Marina Bay Link Mall"</span>,<span class="st">"Marina Square"</span>,<span class="st">"Millenia Walk"</span>,<span class="st">"Mustafa Centre"</span>,<span class="st">"Ngee Ann City"</span>,<span class="st">"Orchard Central"</span>,<span class="st">"Orchard Gateway"</span>,<span class="st">"Orchard Plaza"</span>,<span class="st">"Midpoint Orchard"</span>,<span class="st">"Palais Renaissance"</span>,<span class="st">"People's Park Centre"</span>,<span class="st">"People's Park Complex"</span>,<span class="st">"Plaza Singapura"</span>,<span class="st">"GR.ID"</span>,<span class="st">"Raffles City"</span>,<span class="st">"Scotts Square"</span>,<span class="st">"Shaw Centre"</span>,<span class="st">"Sim Lim Square"</span>,<span class="st">"Singapore Shopping Centre"</span>,<span class="st">"The South Beach"</span>,<span class="st">"Square 2"</span>,<span class="st">"Sunshine Plaza"</span>,<span class="st">"Suntec City"</span>,<span class="st">"Tanglin Mall"</span>,<span class="st">"Tanjong Pagar Centre"</span>,<span class="st">"Tekka Centre"</span>,<span class="st">"The Adelphi"</span>,<span class="st">"The Paragon"</span>,<span class="st">"Tiong Bahru Plaza"</span>,<span class="st">"The Poiz"</span>,<span class="st">"Thomson Plaza"</span>,<span class="st">"United Square"</span>,<span class="st">"Thomson V"</span>,<span class="st">"Velocity@Novena Square"</span>,<span class="st">"Wheelock Place"</span>,<span class="st">"Wisma Atria"</span>,<span class="st">"Zhongshan Mall"</span>,<span class="st">"Bedok Mall"</span>,<span class="st">"Century Square"</span>,<span class="st">"Our Tampines Hub"</span>,<span class="st">"Changi City Point"</span>,<span class="st">"Downtown East"</span>,<span class="st">"Djitsun Mall Bedok"</span>,<span class="st">"Eastpoint Mall"</span>,<span class="st">"Jewel Changi Airport"</span>,<span class="st">"KINEX"</span>,<span class="st">"Katong Shopping Centre"</span>,<span class="st">"Katong Square"</span>,<span class="st">"Kallang Wave Mall"</span>,<span class="st">"Leisure Park Kallang"</span>,<span class="st">"i12 Katong"</span>,<span class="st">"Parkway Parade"</span>,<span class="st">"Paya Lebar Square"</span>,<span class="st">"Paya Lebar Quarter"</span>,<span class="st">"Roxy Square"</span>,<span class="st">"Singpost Centre"</span>,<span class="st">"Tampines 1"</span>,<span class="st">"Tampines Mall"</span>,<span class="st">"White Sands"</span>,<span class="st">"City Plaza"</span>,<span class="st">"Elias Mall"</span>,<span class="st">"Loyang Point"</span>,<span class="st">"888 Plaza"</span>,<span class="st">"Admiralty Place"</span>,<span class="st">"AMK Hub"</span>,<span class="st">"Canberra Plaza"</span>,<span class="st">"Causeway Point"</span>,<span class="st">"Woodlands Civic Centre"</span>,<span class="st">"Broadway Plaza"</span>,<span class="st">"Djitsun Mall"</span>,<span class="st">"Jubilee Square"</span>,<span class="st">"Junction 8"</span>,<span class="st">"Junction Nine"</span>,<span class="st">"Marsiling Mall"</span>,<span class="st">"Northpoint City"</span>,<span class="st">"Sembawang Shopping Centre"</span>,<span class="st">"Sun Plaza"</span>,<span class="st">"Vista Point"</span>,<span class="st">"Wisteria Mall"</span>,<span class="st">"Woodlands Mart"</span>,<span class="st">"Woodlands North Plaza"</span>,<span class="st">"Waterway Point"</span>,<span class="st">"Compass One"</span>,<span class="st">"Hougang Mall"</span>,<span class="st">"Heartland Mall"</span>,<span class="st">"NEX"</span>,<span class="st">"Buangkok Square"</span>,<span class="st">"Greenwich V"</span>,<span class="st">"Hougang 1"</span>,<span class="st">"Hougang Green Shopping Mall"</span>,<span class="st">"Hougang Rivercourt"</span>,<span class="st">"myVillage At Serangoon Garden"</span>,<span class="st">"Northshore Plaza"</span>,<span class="st">"Oasis Terraces"</span>,<span class="st">"Punggol Plaza"</span>,<span class="st">"Rivervale Mall"</span>,<span class="st">"Rivervale Plaza"</span>,<span class="st">"The Seletar Mall"</span>,<span class="st">"Upper Serangoon Shopping Centre"</span>,<span class="st">"Beauty World Centre"</span>,<span class="st">"Beauty World Plaza"</span>,<span class="st">"Bukit Panjang Plaza"</span>,<span class="st">"Bukit Timah Plaza"</span>,<span class="st">"Fajar Shopping Centre"</span>,<span class="st">"Greenridge Shopping Centre"</span>,<span class="st">"Hillion Mall"</span>,<span class="st">"HillV2"</span>,<span class="st">"Junction 10"</span>,<span class="st">"Keat Hong Shopping Centre"</span>,<span class="st">"Limbang Shopping Centre"</span>,<span class="st">"Lot One"</span>,<span class="st">"Rail Mall"</span>,<span class="st">"Sunshine Place"</span>,<span class="st">"Teck Whye Shopping Centre"</span>,<span class="st">"West Mall"</span>,<span class="st">"Yew Tee Point"</span>,<span class="st">"Yew Tee Square"</span>,<span class="st">"VivoCity"</span>,<span class="st">"HarbourFront Centre"</span>,<span class="st">"Alexandra Retail Centre"</span>,<span class="st">"321 Clementi"</span>,<span class="st">"The Clementi Mall"</span>,<span class="st">"IMM"</span>,<span class="st">"JCube"</span>,<span class="st">"Jem"</span>,<span class="st">"Westgate"</span>,<span class="st">"Jurong Point"</span>,<span class="st">"Pioneer Mall"</span>,<span class="st">"The Star Vista"</span>,<span class="st">"Alexandra Central"</span>,<span class="st">"Anchorpoint"</span>,<span class="st">"The GrandStand"</span>,<span class="st">"Boon Lay Shopping Centre"</span>,<span class="st">"Grantral Mall"</span>,<span class="st">"Fairprice Hub"</span>,<span class="st">"Gek Poh Shopping Centre"</span>,<span class="st">"Rochester Mall"</span>,<span class="st">"Taman Jurong Shopping Centre"</span>,<span class="st">"West Coast Plaza"</span>,<span class="st">"Queensway Shopping Centre"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>shop_coords_new <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(new_shopping_mall_list) </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>shop_coords_new </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will check again to make sure that the data is correct</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>shop_coords_new[(<span class="fu">is.na</span>(shop_coords_new<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(shop_coords_new<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(shop_coords_new<span class="sc">$</span>longitude) <span class="sc">|</span> shop_coords_new<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we have confirm that the data is clean, we will just rename the columns to make it easier to understand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(shop_coords_new, <span class="st">"name"</span> <span class="ot">=</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will save it as a shape file so that we can access it much more easily</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>shopping_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(shop_coords_new, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(shopping_sf, <span class="st">"data/extracted/shopping_mall.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><u><strong>Primary School</strong></u></p>
<p>Unlike Megan’s Time where Primary School Data can be found in OneMap API and is found in Data.gov, we need will need to make to do with the list from MOE, which appears to be the best list of data that we have.</p>
<p>You can find the link <a href="https://www.moe.gov.sg/about-us/organisation-structure/sd/school-clusters">here</a>. <code>https://www.moe.gov.sg/about-us/organisation-structure/sd/school-clusters</code></p>
<p>I have extracted the all the data from the MOE and clean it up manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"North Vista Primary School"</span>,<span class="st">"Palm View Primary School"</span>,<span class="st">"Rivervale Primary School"</span>,<span class="st">"Seng Kang Primary School"</span>,<span class="st">"Xinmin Primary School"</span>,<span class="st">"Ahmad Ibrahim Primary School"</span>,<span class="st">"Chongfu School"</span>,<span class="st">"Endeavour Primary School"</span>,<span class="st">"Jiemin Primary School"</span>,<span class="st">"Northland Primary School"</span>,<span class="st">"Northoaks Primary School"</span>,<span class="st">"Xishan Primary School"</span>,<span class="st">"Singapore Chinese Girls' School (Primary)"</span>,<span class="st">"Anchor Green Primary School"</span>,<span class="st">"Compassvale Primary School"</span>,<span class="st">"Edgefield Primary School"</span>,<span class="st">"Fernvale Primary School"</span>,<span class="st">"Hougang Primary School"</span>,<span class="st">"Yio Chu Kang Primary School"</span>,<span class="st">"Catholic High School (Primary)"</span>,<span class="st">"Anchor Green Primary School"</span>,<span class="st">"Compassvale Primary School"</span>,<span class="st">"Edgefield Primary School"</span>,<span class="st">"Fernvale Primary School"</span>,<span class="st">"Hougang Primary School"</span>,<span class="st">"Yio Chu Kang Primary School"</span>,<span class="st">"Catholic High School (Primary)"</span>,<span class="st">"Greendale Primary School"</span>,<span class="st">"Horizon Primary School"</span>,<span class="st">"Mee Toh School"</span>,<span class="st">"Montfort Junior School"</span>,<span class="st">"Nan Chiau Primary School"</span>,<span class="st">"North Spring Primary School"</span>,<span class="st">"Maris Stella High School (Primary)"</span>,<span class="st">"Admiralty Primary School"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>primary_sch_list_2<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Evergreen Primary School"</span>,<span class="st">"Greenwood Primary School"</span>,<span class="st">"Marsiling Primary School"</span>,<span class="st">"Qihua Primary School"</span>,<span class="st">"Woodgrove Primary School"</span>,<span class="st">"Woodlands Ring Primary School"</span>,<span class="st">"Anderson Primary School"</span>,<span class="st">"Huamin Primary School"</span>,<span class="st">"Naval Base Primary School"</span>,<span class="st">"North View Primary School"</span>,<span class="st">"Peiying Primary School"</span>,<span class="st">"Sembawang Primary School"</span>,<span class="st">"Yishun Primary School"</span>,<span class="st">"CHIJ St Nicholas (Primary)"</span>,<span class="st">"Ang Mo Kio Primary School"</span>,<span class="st">"CHIJ Our Lady of Nativity"</span>,<span class="st">"Holy Innocents' Primary School"</span>,<span class="st">"Jing Shan Primary School"</span>,<span class="st">"Mayflower Primary School"</span>,<span class="st">"Punggol Primary School"</span>,<span class="st">"Blangah Rise Primary School"</span>,<span class="st">"Fairfield Methodist School (Primary)"</span>,<span class="st">"New Town Primary School"</span>,<span class="st">"Pei Tong Primary School"</span>,<span class="st">"Queenstown Primary School"</span>,<span class="st">"Anglo-Chinese Primary School"</span>,<span class="st">"CHIJ (Toa Payoh) Primary School"</span>,<span class="st">"First Toa Payoh Primary School"</span>,<span class="st">"Kheng Cheng School"</span>,<span class="st">"Marymount Convent School"</span>,<span class="st">"Pei Chun Public School"</span>,<span class="st">"Raffles Girls’ Primary School"</span>,<span class="st">"Alexandra Primary School"</span>,<span class="st">"Cantonment Primary School"</span>,<span class="st">"CHIJ (Kellock)"</span>,<span class="st">"Gan Eng Seng Primary School"</span>,<span class="st">"Hong Wen School"</span>,<span class="st">"Radin Mas Primary School"</span>,<span class="st">"River Valley Primary School"</span>,<span class="st">"Zhangde Primary School"</span>,<span class="st">"Anglo-Chinese Junior"</span>,<span class="st">"Bendemeer Primary School"</span>,<span class="st">"Farrer Park Primary School"</span>,<span class="st">"St. Andrew's Junior School"</span>,<span class="st">"St. Joseph's Institution Junior"</span>,<span class="st">"St. Margaret's Primary School"</span>,<span class="st">"Cedar Primary School"</span>,<span class="st">"CHIJ Our Lady of Good Counsel"</span>,<span class="st">"St Gabriel’s Primary School"</span>,<span class="st">"Xinghua Primary School"</span>,<span class="st">"Yangzheng Primary School"</span>,<span class="st">"Zhonghua Primary School"</span>,<span class="st">"Ai Tong School"</span>,<span class="st">"Kuo Chuan Presbyterian Primary School"</span>,<span class="st">"Teck Ghee Primary School"</span>,<span class="st">"Townsville Primary School"</span>,<span class="st">"Elias Park Primary School"</span>,<span class="st">"Meridian Primary School"</span>,<span class="st">"Northshore Primary School"</span>,<span class="st">"Punggol Cove Primary School"</span>,<span class="st">"Punggol Green Primary School"</span>,<span class="st">"Punggol View Primary School"</span>,<span class="st">"Valour Primary School"</span>,<span class="st">"Bedok Green Primary School"</span>,<span class="st">"Junyuan Primary School"</span>,<span class="st">"Poi Ching School"</span>,<span class="st">"Red Swastika School"</span>,<span class="st">"Temasek Primary School"</span>,<span class="st">"Yu Neng Primary School"</span>,<span class="st">"Angsana Primary School"</span>,<span class="st">"Chongzheng Primary School"</span>,<span class="st">"East Spring Primary School"</span>,<span class="st">"Fern Green Primary School"</span>,<span class="st">"Gongshang Primary School"</span>,<span class="st">"Sengkang Green Primary School"</span>,<span class="st">"Springdale Primary School"</span>,<span class="st">"Yumin Primary School"</span>,<span class="st">"Changkat Primary School"</span>,<span class="st">"Damai Primary School"</span>,<span class="st">"Kong Hwa School"</span>,<span class="st">"St Anthony’s Canossian Primary School"</span>,<span class="st">"Telok Kurau Primary School"</span>,<span class="st">"Canossa Catholic Primary School"</span>,<span class="st">"Fengshan Primary School"</span>,<span class="st">"Geylang Methodist School (Primary)"</span>,<span class="st">"Haig Girls’ School"</span>,<span class="st">"Paya Lebar Methodist Girls’ School (Primary)"</span>,<span class="st">"Tanjong Katong Primary School"</span>,<span class="st">"Casuarina Primary School"</span>,<span class="st">"Oasis Primary School"</span>,<span class="st">"Park View Primary School"</span>,<span class="st">"Pasir Ris Primary School"</span>,<span class="st">"St. Hilda’s Primary School"</span>,<span class="st">"Tampines North Primary School"</span>,<span class="st">"Tampines Primary School"</span>,<span class="st">"Waterway Primary School"</span>,<span class="st">"White Sands Primary School"</span>,<span class="st">"CHIJ (Katong) Primary"</span>,<span class="st">"Maha Bodhi School"</span>,<span class="st">"Ngee Ann Primary School"</span>,<span class="st">"Opera Estate Primary School"</span>,<span class="st">"St Stephen's Primary School"</span>,<span class="st">"Tao Nan School"</span>,<span class="st">"Clementi Primary School"</span>,<span class="st">"Henry Park Primary School"</span>,<span class="st">"Nan Hua Primary School"</span>,<span class="st">"Qifa Primary School"</span>,<span class="st">"Yuhua Primary School"</span>,<span class="st">"Chua Chu Kang Primary School"</span>,<span class="st">"Concord Primary School"</span>,<span class="st">"De La Salle School"</span>,<span class="st">"Nanyang Primary School"</span>,<span class="st">"South View Primary School"</span>,<span class="st">"Unity Primary School"</span>,<span class="st">"Corporation Primary School"</span>,<span class="st">"Frontier Primary School"</span>,<span class="st">"Jurong West Primary School"</span>,<span class="st">"Pioneer Primary School"</span>,<span class="st">"West Grove Primary School"</span>,<span class="st">"Xingnan Primary School"</span>,<span class="st">"Methodist Girls' School (Primary)"</span>,<span class="st">"Bukit View Primary School"</span>,<span class="st">"Dazhong Primary School"</span>,<span class="st">"Jurong Primary School"</span>,<span class="st">"Keming Primary School"</span>,<span class="st">"Lianhua Primary School"</span>,<span class="st">"St. Anthony's Primary School"</span>,<span class="st">"Beacon Primary School"</span>,<span class="st">"Greenridge Primary School"</span>,<span class="st">"Pei Hwa Presbyterian Primary School"</span>,<span class="st">"Teck Whye Primary School"</span>,<span class="st">"West View Primary School"</span>,<span class="st">"Zhenghua Primary School"</span>,<span class="st">"Boon Lay Garden Primary School"</span>,<span class="st">"Bukit Panjang Primary School"</span>,<span class="st">"CHIJ Our Lady Queen of Peace"</span>,<span class="st">"Kranji Primary School"</span>,<span class="st">"West Spring Primary School"</span>,<span class="st">"Westwood Primary School"</span>,<span class="st">"Yew Tee Primary School"</span>,<span class="st">"Bukit Timah Primary School"</span>,<span class="st">"Fuhua Primary School"</span>,<span class="st">"Lakeside Primary School"</span>,<span class="st">"Princess Elizabeth Primary School"</span>,<span class="st">"Rulang Primary School"</span>,<span class="st">"Shuqun Primary School"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will make use of the same function to get the list of Primary School Coordinates of Primary School</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(primary_sch_list) </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor2 <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(primary_sch_list_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we Again we will check if both have any error</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor[(<span class="fu">is.na</span>(primary_sch_list_coor<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor<span class="sc">$</span>longitude) <span class="sc">|</span> primary_sch_list_coor<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor2[(<span class="fu">is.na</span>(primary_sch_list_coor2<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor2<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor2<span class="sc">$</span>longitude) <span class="sc">|</span> primary_sch_list_coor2<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the results above, we can see that there are 7 addresses that does not contain any information at all:</p>
<ul>
<li><p>Maris Stella High School (Primary)</p></li>
<li><p>CHIJ St Nicholas (Primary)</p></li>
<li><p>CHIJ (Toa Payoh) Primary School</p></li>
<li><p>St Gabriel’s Primary School</p></li>
<li><p>St Anthony’s Canossian Primary School</p></li>
<li><p>St.&nbsp;Hilda’s Primary School</p></li>
<li><p>St Stephen’s Primary School</p></li>
</ul>
<p>I research deeper into the situation and found reverse search the malls to find their Postal Code, afterwards I will search out the name based on the One Map API and found the following:</p>
<ul>
<li><p>Maris Stella High School (Primary) is called <code>Maris Stella High School</code></p></li>
<li><p>CHIJ St Nicholas (Primary) is called <code>CHIJ St Nicholas</code></p></li>
<li><p>CHIJ (Toa Payoh) Primary School is called <code>CHIJ Primary (Toa Payoh)</code></p></li>
<li><p>St Gabriel’s Primary School is called <code>Saint Gabriel Primary School</code></p></li>
<li><p>St Anthony’s Canossian Primary School is called <code>Saint Anthony Canossian Primary School</code></p></li>
<li><p>St.&nbsp;Hilda’s Primary School is called <code>Saint Hilda Primary School</code></p></li>
<li><p>St Stephen’s Primary School is called <code>Saint Stephen School</code></p></li>
</ul>
<p>We will just replace it in the names in the list again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"North Vista Primary School"</span>,<span class="st">"Palm View Primary School"</span>,<span class="st">"Rivervale Primary School"</span>,<span class="st">"Seng Kang Primary School"</span>,<span class="st">"Xinmin Primary School"</span>,<span class="st">"Ahmad Ibrahim Primary School"</span>,<span class="st">"Chongfu School"</span>,<span class="st">"Endeavour Primary School"</span>,<span class="st">"Jiemin Primary School"</span>,<span class="st">"Northland Primary School"</span>,<span class="st">"Northoaks Primary School"</span>,<span class="st">"Xishan Primary School"</span>,<span class="st">"Singapore Chinese Girls' School (Primary)"</span>,<span class="st">"Anchor Green Primary School"</span>,<span class="st">"Compassvale Primary School"</span>,<span class="st">"Edgefield Primary School"</span>,<span class="st">"Fernvale Primary School"</span>,<span class="st">"Hougang Primary School"</span>,<span class="st">"Yio Chu Kang Primary School"</span>,<span class="st">"Catholic High School (Primary)"</span>,<span class="st">"Anchor Green Primary School"</span>,<span class="st">"Compassvale Primary School"</span>,<span class="st">"Edgefield Primary School"</span>,<span class="st">"Fernvale Primary School"</span>,<span class="st">"Hougang Primary School"</span>,<span class="st">"Yio Chu Kang Primary School"</span>,<span class="st">"Catholic High School (Primary)"</span>,<span class="st">"Greendale Primary School"</span>,<span class="st">"Horizon Primary School"</span>,<span class="st">"Mee Toh School"</span>,<span class="st">"Montfort Junior School"</span>,<span class="st">"Nan Chiau Primary School"</span>,<span class="st">"North Spring Primary School"</span>,<span class="st">"Maris Stella High School"</span>,<span class="st">"Admiralty Primary School"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>primary_sch_list_2<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Evergreen Primary School"</span>,<span class="st">"Greenwood Primary School"</span>,<span class="st">"Marsiling Primary School"</span>,<span class="st">"Qihua Primary School"</span>,<span class="st">"Woodgrove Primary School"</span>,<span class="st">"Woodlands Ring Primary School"</span>,<span class="st">"Anderson Primary School"</span>,<span class="st">"Huamin Primary School"</span>,<span class="st">"Naval Base Primary School"</span>,<span class="st">"North View Primary School"</span>,<span class="st">"Peiying Primary School"</span>,<span class="st">"Sembawang Primary School"</span>,<span class="st">"Yishun Primary School"</span>,<span class="st">"CHIJ St Nicholas"</span>,<span class="st">"Ang Mo Kio Primary School"</span>,<span class="st">"CHIJ Our Lady of Nativity"</span>,<span class="st">"Holy Innocents' Primary School"</span>,<span class="st">"Jing Shan Primary School"</span>,<span class="st">"Mayflower Primary School"</span>,<span class="st">"Punggol Primary School"</span>,<span class="st">"Blangah Rise Primary School"</span>,<span class="st">"Fairfield Methodist School (Primary)"</span>,<span class="st">"New Town Primary School"</span>,<span class="st">"Pei Tong Primary School"</span>,<span class="st">"Queenstown Primary School"</span>,<span class="st">"Anglo-Chinese Primary School"</span>,<span class="st">"CHIJ Primary (Toa Payoh)"</span>,<span class="st">"First Toa Payoh Primary School"</span>,<span class="st">"Kheng Cheng School"</span>,<span class="st">"Marymount Convent School"</span>,<span class="st">"Pei Chun Public School"</span>,<span class="st">"Raffles Girls’ Primary School"</span>,<span class="st">"Alexandra Primary School"</span>,<span class="st">"Cantonment Primary School"</span>,<span class="st">"CHIJ (Kellock)"</span>,<span class="st">"Gan Eng Seng Primary School"</span>,<span class="st">"Hong Wen School"</span>,<span class="st">"Radin Mas Primary School"</span>,<span class="st">"River Valley Primary School"</span>,<span class="st">"Zhangde Primary School"</span>,<span class="st">"Anglo-Chinese Junior"</span>,<span class="st">"Bendemeer Primary School"</span>,<span class="st">"Farrer Park Primary School"</span>,<span class="st">"St. Andrew's Junior School"</span>,<span class="st">"St. Joseph's Institution Junior"</span>,<span class="st">"St. Margaret's Primary School"</span>,<span class="st">"Cedar Primary School"</span>,<span class="st">"CHIJ Our Lady of Good Counsel"</span>,<span class="st">"Saint Gabriel Primary School"</span>,<span class="st">"Xinghua Primary School"</span>,<span class="st">"Yangzheng Primary School"</span>,<span class="st">"Zhonghua Primary School"</span>,<span class="st">"Ai Tong School"</span>,<span class="st">"Kuo Chuan Presbyterian Primary School"</span>,<span class="st">"Teck Ghee Primary School"</span>,<span class="st">"Townsville Primary School"</span>,<span class="st">"Elias Park Primary School"</span>,<span class="st">"Meridian Primary School"</span>,<span class="st">"Northshore Primary School"</span>,<span class="st">"Punggol Cove Primary School"</span>,<span class="st">"Punggol Green Primary School"</span>,<span class="st">"Punggol View Primary School"</span>,<span class="st">"Valour Primary School"</span>,<span class="st">"Bedok Green Primary School"</span>,<span class="st">"Junyuan Primary School"</span>,<span class="st">"Poi Ching School"</span>,<span class="st">"Red Swastika School"</span>,<span class="st">"Temasek Primary School"</span>,<span class="st">"Yu Neng Primary School"</span>,<span class="st">"Angsana Primary School"</span>,<span class="st">"Chongzheng Primary School"</span>,<span class="st">"East Spring Primary School"</span>,<span class="st">"Fern Green Primary School"</span>,<span class="st">"Gongshang Primary School"</span>,<span class="st">"Sengkang Green Primary School"</span>,<span class="st">"Springdale Primary School"</span>,<span class="st">"Yumin Primary School"</span>,<span class="st">"Changkat Primary School"</span>,<span class="st">"Damai Primary School"</span>,<span class="st">"Kong Hwa School"</span>,<span class="st">"Saint Anthony Canossian Primary School"</span>,<span class="st">"Telok Kurau Primary School"</span>,<span class="st">"Canossa Catholic Primary School"</span>,<span class="st">"Fengshan Primary School"</span>,<span class="st">"Geylang Methodist School (Primary)"</span>,<span class="st">"Haig Girls’ School"</span>,<span class="st">"Paya Lebar Methodist Girls’ School (Primary)"</span>,<span class="st">"Tanjong Katong Primary School"</span>,<span class="st">"Casuarina Primary School"</span>,<span class="st">"Oasis Primary School"</span>,<span class="st">"Park View Primary School"</span>,<span class="st">"Pasir Ris Primary School"</span>,<span class="st">"Saint Hilda Primary School"</span>,<span class="st">"Tampines North Primary School"</span>,<span class="st">"Tampines Primary School"</span>,<span class="st">"Waterway Primary School"</span>,<span class="st">"White Sands Primary School"</span>,<span class="st">"CHIJ (Katong) Primary"</span>,<span class="st">"Maha Bodhi School"</span>,<span class="st">"Ngee Ann Primary School"</span>,<span class="st">"Opera Estate Primary School"</span>,<span class="st">"Saint Stephen School"</span>,<span class="st">"Tao Nan School"</span>,<span class="st">"Clementi Primary School"</span>,<span class="st">"Henry Park Primary School"</span>,<span class="st">"Nan Hua Primary School"</span>,<span class="st">"Qifa Primary School"</span>,<span class="st">"Yuhua Primary School"</span>,<span class="st">"Chua Chu Kang Primary School"</span>,<span class="st">"Concord Primary School"</span>,<span class="st">"De La Salle School"</span>,<span class="st">"Nanyang Primary School"</span>,<span class="st">"South View Primary School"</span>,<span class="st">"Unity Primary School"</span>,<span class="st">"Corporation Primary School"</span>,<span class="st">"Frontier Primary School"</span>,<span class="st">"Jurong West Primary School"</span>,<span class="st">"Pioneer Primary School"</span>,<span class="st">"West Grove Primary School"</span>,<span class="st">"Xingnan Primary School"</span>,<span class="st">"Methodist Girls' School (Primary)"</span>,<span class="st">"Bukit View Primary School"</span>,<span class="st">"Dazhong Primary School"</span>,<span class="st">"Jurong Primary School"</span>,<span class="st">"Keming Primary School"</span>,<span class="st">"Lianhua Primary School"</span>,<span class="st">"St Anthony's Primary School"</span>,<span class="st">"Beacon Primary School"</span>,<span class="st">"Greenridge Primary School"</span>,<span class="st">"Pei Hwa Presbyterian Primary School"</span>,<span class="st">"Teck Whye Primary School"</span>,<span class="st">"West View Primary School"</span>,<span class="st">"Zhenghua Primary School"</span>,<span class="st">"Boon Lay Garden Primary School"</span>,<span class="st">"Bukit Panjang Primary School"</span>,<span class="st">"CHIJ Our Lady Queen of Peace"</span>,<span class="st">"Kranji Primary School"</span>,<span class="st">"West Spring Primary School"</span>,<span class="st">"Westwood Primary School"</span>,<span class="st">"Yew Tee Primary School"</span>,<span class="st">"Bukit Timah Primary School"</span>,<span class="st">"Fuhua Primary School"</span>,<span class="st">"Lakeside Primary School"</span>,<span class="st">"Princess Elizabeth Primary School"</span>,<span class="st">"Rulang Primary School"</span>,<span class="st">"Shuqun Primary School"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(primary_sch_list) </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor2 <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(primary_sch_list_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will need to check again to make sure that there is no missing data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor[(<span class="fu">is.na</span>(primary_sch_list_coor<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor<span class="sc">$</span>longitude) <span class="sc">|</span> primary_sch_list_coor<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor2[(<span class="fu">is.na</span>(primary_sch_list_coor2<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor2<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(primary_sch_list_coor2<span class="sc">$</span>longitude) <span class="sc">|</span> primary_sch_list_coor2<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we have confirm that the data is clean, we will just rename the columns to make it easier to understand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>primary_sch_list_coor_full <span class="ot">&lt;-</span> <span class="fu">rbind</span>(primary_sch_list_coor, primary_sch_list_coor2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(primary_sch_list_coor_full, <span class="st">"name"</span> <span class="ot">=</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can write it into a shape file for us to access everything again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>primary_sch_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(primary_sch_list_coor_full, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(primary_sch_sf, <span class="st">"data/extracted/primary_school.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><u><strong>Good Primary School</strong></u></p>
<p>Education and academic institutions are an especially important locational factors for families with children, or expect to have children. Since it has already been proven that <a href="https://www.moe.gov.sg/primary/p1-registration/distance">distance affects priority admission</a>, the number of good Primary School around the area is important as well. For this analysis, our focus will be on the primary-school level of education, we would need to understand what is defined as “Good Primary School”. MOE does not released a list of Primary Schools ranked based on their result as such, there is now way to determine how the Primary School are actually ranked.</p>
<p>One possible example of the ranking would be the <a href="https://schlah.com/primary-schools">schlah’s Primary School Rankings</a> from the 2020. Although the list is a bit dated, It does offer a transparent method on how they determined what is considered a “Good Primary School” primarily through:</p>
<ul>
<li><p>Popularity in Primary 1 (P1) Registration: 20%</p></li>
<li><p>Gifted Education Programme (GEP): 20%</p></li>
<li><p>Special Assistance Plan (SAP): 15%</p></li>
<li><p>Achievements in the Singapore Youth Festival Arts Presentation: 15%</p></li>
<li><p>Representation in the Singapore National School Games: 15%</p></li>
<li><p>Singapore Uniformed Groups Unit Recognition: 15%</p></li>
</ul>
<p>For my analysis, I will consider the Top 10 Primary School as Good Primary School:</p>
<p><img src="images/image-476731336.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>good_primary_school <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Nanyang Primary School"</span>,<span class="st">"Tao Nan School"</span>,<span class="st">"Catholic High School (Primary)"</span>,<span class="st">"Nan Hua Primary School"</span>,<span class="st">"Saint Hilda Primary School"</span>,<span class="st">"Henry Park Primary School"</span>,<span class="st">"Anglo-Chinese Primary School"</span>,<span class="st">"Raffles Girls’ Primary School"</span>,<span class="st">"Pei Hwa Presbyterian Primary School"</span>,<span class="st">"CHIJ St Nicholas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will once again make use of the OneMap API to get the theme</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>good_primary_school_coor <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(good_primary_school) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will need to check again to make sure that there is no missing data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>good_primary_school_coor[(<span class="fu">is.na</span>(good_primary_school_coor<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(good_primary_school_coor<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(good_primary_school_coor<span class="sc">$</span>longitude) <span class="sc">|</span> good_primary_school_coor<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we have confirm that the data is cleaned we can save it as a shape file to reference again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(good_primary_school_coor, <span class="st">"name"</span> <span class="ot">=</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>good_primary_sch_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(good_primary_school_coor, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(good_primary_sch_sf, <span class="st">"data/extracted/good_primary_school.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><u><strong>CBD</strong></u></p>
<p>Lastly, we need to factor in the proximity to the Central Business District - in the Downtown Core. It’s located in the southwest of Singapore. As such, let’s take the coordinates of Downtown Core to be the coordinates of the CBD, we will store it as a CBD as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fl">1.287953</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>lng <span class="ot">&lt;-</span> <span class="fl">103.851784</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>cbd_sf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lat, lng) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lng"</span>, <span class="st">"lat"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(cbd_sf, <span class="st">"data/extracted/cbd.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="load-in-all-the-shape-data" class="level1">
<h1>Load in all the shape data</h1>
<p>Remember all the Shape File that we have save from the above pre processing we can now load them again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="st">"MPSZ-2019"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>national_boundary <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="st">"CostalOutline"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>childcare <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"childcare"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>eldercare <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"eldercare"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>hawker_centre <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"hawkercentre"</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>kindergarten <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"kindergartens"</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>parks <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"nationalparks"</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>libraries <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"libraries"</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>isp_clinics <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"moh_isp_clinics"</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>tourism <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"tourism"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>bus_stop <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"BusStop"</span>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>primary_sch <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"primary_sch"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(primary_sch, <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>top_primary_sch <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"top10_pri_sch"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(top_primary_sch, <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>registered_pharmacy <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"registered_pharmacy"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(registered_pharmacy, <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>CBD <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"cbd"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(CBD, <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>mrts <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">"data/geospatial"</span>, <span class="at">layer=</span><span class="st">"mrt_lrt"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(mrts, <span class="at">crs=</span><span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will need to convert the shape file into CRS 3414 just in case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>childcare3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(childcare, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>eldercare3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(eldercare, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>hawker_centre3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(hawker_centre, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>kindergarten3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(kindergarten, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>parks3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(parks, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>libraries3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(libraries, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>isp_clinics3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(isp_clinics, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>tourism3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(tourism, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>primary_sch_sf_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(primary_sch, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>top_primary_sch_sf_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(top_primary_sch, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>registered_pharmacy_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(registered_pharmacy, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>CBD_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(CBD, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>mrts_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mrts, <span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>bus_stop_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(bus_stop, <span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We already have a shopping mall shape file that we can used from the pre processing done above. Another method which is faster could be done if you already have a csv file, which can be done in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>shopping_mall <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/shopping_mall.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please note that there must be longitude and latitude attributes in the csv file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>shopping_mall_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(shopping_mall, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>shopping_mall_sf_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(shopping_mall_sf, <span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="importing-supermarket-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-supermarket-data">Importing SuperMarket Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/supermarkets.kml"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how the supermarket has a Z coordinates. The Z coordinates only contains 0 values and hence we would need to drop it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>supermarket_sf <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(supermarket_sf)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>supermarket_sf_3414 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(supermarket_sf, <span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-the-resale-data-1" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-resale-data-1">Importing the Resale Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/resale-flat-prices-from-jan-2017-onwards.csv"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(resale_flat_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Taking a look at the data we have noticed that the data set contains 11 columns with 23656 observations. Depending on when your data is loaded, it can have more observations. They have the following columns: <strong><em>months, town, flat_type, block, street_name, storey_range, floor_area_sqm, flat_model, remaining_lease, resale_price.</em></strong></p>
</section>
</section>
<section id="transforming-the-resale-data-1" class="level1">
<h1>Transforming the Resale Data</h1>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following steps are made with reference to: Take Home Exercise 3 done by: NOR AISYAH BINTE AJIT. Check out her work <a href="https://aisyahajit2018-is415.netlify.app/posts/2021-11-07-take-home-exercise-3/">here</a>.</p>
</div>
</div>
<p>Now that we have correctly filter out the dataset that we wish to use, we are left with another problem. Lets have a look at our data as an example for me to better illustrate the problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_flat_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In our analysis, we are looking at the following key_factors:</p>
<ul>
<li><p>Area of the unit</p></li>
<li><p>Floor level</p></li>
<li><p>Remaining lease</p></li>
<li><p>Age of the unit</p></li>
</ul>
<p>With regards to the key factor. Notice how there are 4 key issues that we need to addressed:</p>
<ol type="1">
<li><p><strong>No geospatial data:</strong> There is no geospatial data for us to plot out the points. This is worrying as the geospatial data is needed for us to perform geographically weighted regression. Fortunately, the data frame provided 2 columns that are critical in retrieving the coordinates of the flat, however it is found in <strong><em>2 different columns:</em></strong> <strong>block, street_name</strong>. We would need to concatenate them together into to search for their coordinates.</p></li>
<li><p><strong>remaining_lease is recorded as a string:</strong> The remaining leases data is found as a string, when it should be an continuos variable. It is current written as a string currently, which will be treated as a categorical data instead, as such we would need to convert it into the correct format first.</p></li>
<li><p><strong>storey_range is given as a range:</strong> In our dataset, the floor of the exact unique is not given, but rather a range is given this could be a huge potential issue as this would mean thatthe data will treated as a categorical data. We would need to convert it into the correct format first</p></li>
<li><p><strong>No age</strong>: There is no age in our dataset, which would mean that we would need to solve this issue as well.</p></li>
</ol>
<section id="retrieving-postal-codes-and-coordinates-of-the-address-1" class="level2">
<h2 class="anchored" data-anchor-id="retrieving-postal-codes-and-coordinates-of-the-address-1">Retrieving Postal Codes and Coordinates of the address</h2>
<p>As mentioned before, one of the key issues that we would need to perform is to retrieve all the relevant data such as postal code and coordinates of the address that is needed for later analysis.</p>
<p>The steps are as followed:</p>
<ol type="1">
<li><p>Combining Block and Street Name to form an address</p></li>
<li><p>Filtering out Unique Address</p></li>
<li><p>Retrieving coordinates from OneMap.API</p></li>
<li><p>Inspecting the Result and Fixing the Issues</p></li>
</ol>
<section id="step-1-combining-block-and-street-name-to-form-an-address-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-combining-block-and-street-name-to-form-an-address-1">Step 1: Combining Block and Street Name to form an address</h3>
<p>In this step, we will be combining the street_name and block to form an address.</p>
<p>We can make use of the <code>paste()</code> function from base R to concatenate the two data together. Find out more <a href="https://rdrr.io/r/base/paste.html">here</a>.</p>
<p>Afterwards, we will placed the data in a new columns called address in the dataframe by using the <code>mutate()</code> function from dplyr. Find out more about <a href="https://dplyr.tidyverse.org/reference/mutate.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">address =</span> <span class="fu">paste</span>(block,street_name))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_flat_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-filtering-out-unique-address.-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-filtering-out-unique-address.-1">Step 2: Filtering out Unique Address.</h3>
<p>This step is performed in order to minimize the amount of API Call that we need to perform. Furthermore, this also makes it easier for us to see which of the address will result in an error.</p>
<p>We will first get the unique address out first before sorting the data. This can be done with the <code>sort()</code> from base R. Find out more <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/sort">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>add_list <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_flat_full<span class="sc">$</span>address))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3-retrieiving-coordinates-from-onemap-api-1" class="level3">
<h3 class="anchored" data-anchor-id="step-3-retrieiving-coordinates-from-onemap-api-1">Step 3: Retrieiving Coordinates from OneMap API</h3>
<p>To retrieve the coordinates from OneMap API, it will be easier to create a function to retrieve all the coordinate instead. To do so, lets take a deep dive into the OneMap API. Documentation can be found <a href="https://www.onemap.gov.sg/docs/#onemap-rest-apis">here</a>. In this case, we will be making use of the OneMap API search API to retrieve the necessary coordinates.</p>
<p>According to the documentation, the request requires the following.</p>
<ul>
<li><p><strong>searchVal:</strong> Keywords entered by user that is used to filter out the results.</p></li>
<li><p><strong>returnGeom {Y/N}:</strong> Checks if user wants to return the geometry.</p></li>
<li><p><strong>getAddrDetails {Y/N}</strong>: Checks if user wants to return address details for a point.</p></li>
<li><p><strong>pageNum</strong>: Specifies the page to retrieve your search results from. <em>This is optional (We will not be using this in this case)</em></p></li>
</ul>
<p>A provided example link would be something like this: <em>https://developers.onemap.sg/commonapi/search?searchVal=revenue&amp;returnGeom=Y&amp;getAddrDetails=Y&amp;pageNum=1</em></p>
<p>We are only interested in the LATITUDE and LONGITUDE data in this case.</p>
<p>Now that we understand the API better, we will now create a function that will help us sort through all the data. The following code chunk below does a number of critical steps:</p>
<ol type="1">
<li><p>We will create a data frame called postal_coords that will store all the data frame.</p></li>
<li><p>We will make use of the <code>GET()</code> function from httr package to make a get request call. Find out more <a href="https://httr.r-lib.org/reference/GET.html">here</a>.</p></li>
<li><p>We will create a data frame called new role to store all the coordinates</p></li>
<li><p>We also need to check the number of responses returned and append to the main data frame accordingly. This is because there are a few conditions to take note of</p>
<ul>
<li><p>The number of results can be greater than one or none at all. (<em>indicated by found</em> in the JSON).</p></li>
<li><p>The results returned can have no postal code (<em>which we will not consider as valid)</em></p></li>
<li><p>We will take the first result with a valid postal code as the correct coordinates.</p></li>
</ul></li>
<li><p>Lastly, we will append the returned response (<strong>new_row</strong>) with the necessary fields to the main dataframe (<strong>postal_coords</strong>) using <code>rbind()</code> function of base R package. Find out more <a href="https://rdrr.io/r/base/cbind.html">here</a>.</p></li>
</ol>
<p>All of this can be found in the code chunk below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>get_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(add_list){</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame to store all retrieved coordinates</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  postal_coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> add_list){</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(i)</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">'https://developers.onemap.sg/commonapi/search?'</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">query=</span><span class="fu">list</span>(<span class="at">searchVal=</span>i,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">returnGeom=</span><span class="st">'Y'</span>,</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">getAddrDetails=</span><span class="st">'Y'</span>))</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(r<span class="sc">$</span>content))</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    found <span class="ot">&lt;-</span> data<span class="sc">$</span>found</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> data<span class="sc">$</span>results</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new data frame for each address</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If single result, append </span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (found <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>      postal <span class="ot">&lt;-</span> res<span class="sc">$</span>POSTAL </span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> res<span class="sc">$</span>LATITUDE</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>      lng <span class="ot">&lt;-</span> res<span class="sc">$</span>LONGITUDE</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> postal, <span class="at">latitude =</span> lat, <span class="at">longitude =</span> lng)</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If multiple results, drop NIL and append top 1</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (found <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove those with NIL as postal</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>      res_sub <span class="ot">&lt;-</span> res[res<span class="sc">$</span>POSTAL <span class="sc">!=</span> <span class="st">"NIL"</span>, ]</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set as NA first if no Postal</span></span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(res_sub) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>          new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> <span class="cn">NA</span>, <span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>        top1 <span class="ot">&lt;-</span> <span class="fu">head</span>(res_sub, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>        postal <span class="ot">&lt;-</span> top1<span class="sc">$</span>POSTAL </span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>        lat <span class="ot">&lt;-</span> top1<span class="sc">$</span>LATITUDE</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>        lng <span class="ot">&lt;-</span> top1<span class="sc">$</span>LONGITUDE</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> postal, <span class="at">latitude =</span> lat, <span class="at">longitude =</span> lng)</span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, <span class="at">postal =</span> <span class="cn">NA</span>, <span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the row</span></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a>    postal_coords <span class="ot">&lt;-</span> <span class="fu">rbind</span>(postal_coords, new_row)</span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(postal_coords)</span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the function define we can call the function to generate out the data frame of the postal codes.</p>
<p>Please note that this function does take some time to run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(add_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-inspecting-the-result-and-fixing-the-issues-1" class="level3">
<h3 class="anchored" data-anchor-id="step-4-inspecting-the-result-and-fixing-the-issues-1">Step 4: Inspecting the Result and Fixing the Issues</h3>
<p>Remember all the issues that we can face when making the api call, we would need to check to make sure that all the data is accounted for.</p>
<p>We can make use of the <code>is.na()</code> function to check which street address contains any NA values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>coords[(<span class="fu">is.na</span>(coords<span class="sc">$</span>postal) <span class="sc">|</span> <span class="fu">is.na</span>(coords<span class="sc">$</span>latitude) <span class="sc">|</span> <span class="fu">is.na</span>(coords<span class="sc">$</span>longitude) <span class="sc">|</span> coords<span class="sc">$</span>postal<span class="sc">==</span><span class="st">"NIL"</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The issues can be different so make sure to correct them based on your own observations.</p>
</div>
</div>
<p>Based on the data frame above, we have noticed that there seems to be 2 address with no postal code</p>
<ul>
<li><p>215 CHOA CHU KANG</p></li>
<li><p>216 CHOA CHU KANG</p></li>
</ul>
<p>When searching directly with OneMap API instead, we found that OneMap API classified them as the same building instead with the results being <strong><em>“BLK 216 AND 215 CHOA CHU KANG CENTRAL”.</em></strong> Furthermore a brief check on the website: property indicates the postal code as</p>
<ul>
<li><p><a href="https://www.propertyguru.com.sg/singapore-property-listing/hdb/choa-chu-kang/choa-chu-kang-central_104043/215">680215</a></p></li>
<li><p><a href="https://www.propertyguru.com.sg/singapore-property-listing/hdb/choa-chu-kang/choa-chu-kang-central_104043/216">680216</a></p></li>
</ul>
<p>We shall proceed with keeping them as the same as there is the latitude and longitude data.</p>
</section>
</section>
<section id="transforming-remaining-lease-1" class="level2">
<h2 class="anchored" data-anchor-id="transforming-remaining-lease-1">Transforming Remaining Lease</h2>
<p>In this section, we will be transforming the remaining lease into an integer.</p>
<p>First, we will split the remaining lease into years and months columns for calculation. To do so, we will make use of <code>str_sub()</code> function from tidyverse. Find out more <a href="https://stringr.tidyverse.org/reference/str_sub.html">here</a>.</p>
<p>we will convert the string into an integer using the <code>as.integer()</code> function from base R. Find out more <a href="https://rdrr.io/r/base/integer.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">remaining_lease_yr =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">0</span>, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">remaining_lease_mth =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">9</span>, <span class="dv">11</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will then convert the NA values of the remaining_lease_mth columns into 0. We can make use of the <code>is.na()</code> function from base R. Find out more <a href="https://rdrr.io/r/base/NA.html">here</a>.</p>
<p>Followed by changing the remaining_lease_yr into months.</p>
<p>Finally, we can sum the two columns together with <code>rowSums()</code> function from base R. Find out more <a href="https://rdrr.io/r/base/colSums.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full<span class="sc">$</span>remaining_lease_mth[<span class="fu">is.na</span>(resale_flat_full<span class="sc">$</span>remaining_lease_mth)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>resale_flat_full<span class="sc">$</span>remaining_lease_yr <span class="ot">&lt;-</span> resale_flat_full<span class="sc">$</span>remaining_lease_yr <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span> </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">remaining_lease_mths =</span> <span class="fu">rowSums</span>(resale_flat_full[, <span class="fu">c</span>(<span class="st">"remaining_lease_yr"</span>, <span class="st">"remaining_lease_mth"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transforming-storey-range-1" class="level2">
<h2 class="anchored" data-anchor-id="transforming-storey-range-1">Transforming Storey Range</h2>
<p>Categorical variables require special attention in regression analysis because, unlike continuous variables, they <em>cannot</em> be entered into the regression equation just as they are. A method we can used to convert categorical variables into continuous variable is called “treatment” coding, or “dummy” coding. This method involve converting the categorical variable into a reference number.</p>
<p>However, we must understand that <strong><em>storey range</em></strong> is an ordinal data, in other words, each categorical has an order, or in this case, low to high. Using a dummy variable might not make as much sense in this case. Hence, we will assign a higher value to higher floors. The reasoning behind it is that a higher floor offers more privacy, better security and lower noise pollution due to the high height.</p>
<p>We will first create a dataframe to store all the unique storey range and at the same time sort them. After they are sorted we will create a list of encoding based on the unique values then merging them to form a data frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>storeys <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_flat_full<span class="sc">$</span>storey_range))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>storey_order <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(storeys)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>storey_range_order <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(storeys, storey_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(storey_range_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the above results, we can see that:</p>
<ul>
<li><p>01 TO 03 is assigned the value: 1</p></li>
<li><p>04 TO 06 is assigned the value: 2</p></li>
<li><p>07 TO 09 is assigned the value: 3</p></li>
<li><p>10 TO 12 is assigned the value: 4</p></li>
<li><p>13 TO 15 is assigned the value: 5</p></li>
<li><p>16 TO 18 is assigned the value: 6</p></li>
</ul>
<p>Hence, the storey range are in the correct order</p>
</section>
<section id="transforming-age-1" class="level2">
<h2 class="anchored" data-anchor-id="transforming-age-1">Transforming Age</h2>
<p>Age is one of the key factors that we are using in our analysis. However, there is no direct reference to age of the HDB. One method we can use is to infer the age of the building based on the remaining lease. It is well known that Singapore HDB are leased to us for 99 years as such we can calculate the age based on the difference between the total lease and remaining lease.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(resale_flat_full, <span class="at">age =</span> <span class="dv">99</span> <span class="sc">*</span> <span class="dv">12</span> <span class="sc">-</span> resale_flat_full<span class="sc">$</span>remaining_lease_mths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_flat_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span> <span class="fu">left_join</span>(resale_flat_full, storey_range_order, <span class="at">by=</span> <span class="fu">c</span>(<span class="st">"storey_range"</span> <span class="ot">=</span> <span class="st">"storeys"</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>rs_coords <span class="ot">&lt;-</span> <span class="fu">left_join</span>(resale_flat_full, coords, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'address'</span> <span class="ot">=</span> <span class="st">'address'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>rs_coords_rds <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(rs_coords, <span class="st">"data/rds/rs_coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>rs_coords <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/rs_coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>rs_coords_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(rs_coords,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"latitude"</span>),</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-proximity" class="level2">
<h2 class="anchored" data-anchor-id="calculating-proximity">Calculating Proximity</h2>
<p>One of the things we need to find is the proximity to particular facilities as one of factors.</p>
<p>Megan has kindly provided the function for us to use above. First, she use compute with <code>st_distance(),</code> to compute the proximity to the facility and find the closest facility (shortest distance) with the <code>rowMins()</code> function of our matrixStats package. The values will be appended to the data frame as a new column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>proximity <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname) {</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    units<span class="sc">::</span><span class="fu">drop_units</span>()</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowMins</span>(dist_matrix)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>rs_coords_sf <span class="ot">&lt;-</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the columns will be truncated later on when viewing </span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># so we're limiting ourselves to two-character columns for ease of viewing between</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(rs_coords_sf, CBD_3414, <span class="st">"PROX_CBD"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., childcare3414, <span class="st">"PROX_CHILDCARE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., eldercare3414, <span class="st">"PROX_ELDERCARE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., hawker_centre3414, <span class="st">"PROX_HAWKER"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., mrts_3414 , <span class="st">"PROX_MRT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., parks3414, <span class="st">"PROX_PARK"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., top_primary_sch_sf_3414, <span class="st">"PROX_TOPPRISCH"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., shopping_mall_sf_3414, <span class="st">"PROX_MALL"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., supermarket_sf_3414, <span class="st">"PROX_SPRMKT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., isp_clinics3414, <span class="st">"PROX_CLINIC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., registered_pharmacy_3414, <span class="st">"PROX_PHARMACY"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., tourism3414, <span class="st">"PROX_TOURISM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., libraries3414, <span class="st">"PROX_LIBRARY"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="facility-count-within-radius" class="level2">
<h2 class="anchored" data-anchor-id="facility-count-within-radius">Facility Count Within Radius</h2>
<p>Other than proximity, which calculates the shortest distance, we also want to find the <em>number</em> of facilities within a particular radius as another factors.</p>
<p>Megan has kindly provided the function for us to use above. First, she use <code>st_distance()</code> to compute the distance between the flats and the desired facilities, and then sum up the observations with <code>rowSums()</code>. The values will be appended to the data frame as a new column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>num_radius <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname, radius) {</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_units</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(dist_matrix <span class="sc">&lt;=</span> radius)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>rs_coords_sf <span class="ot">&lt;-</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(rs_coords_sf, kindergarten3414, <span class="st">"NUM_KNDRGTN"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., childcare3414, <span class="st">"NUM_CHILDCARE"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., bus_stop_3414, <span class="st">"NUM_BUS_STOP"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., isp_clinics3414, <span class="st">"NUM_ISP_CLIN"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., registered_pharmacy_3414, <span class="st">"NUM_REGISTERED_PHARM"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">num_radius</span>(., libraries3414, <span class="st">"NUM_LIBRARIES"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">num_radius</span>(., primary_sch_sf_3414, <span class="st">"NUM_PRI_SCH"</span>, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="saving-the-data-into-rds" class="level2">
<h2 class="anchored" data-anchor-id="saving-the-data-into-rds">Saving the Data into RDS</h2>
<p>Well we do not really need all the columns, and we also do not want to read all the files again, we can save it as a rds format so that we can access it again.</p>
<p>Before we save it into RDS, we can clean up columns that we do not really need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>rs_coords_full_rds <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(rs_coords_sf, <span class="st">"data/rds/rs_coords_full.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You have now pre processed the data and you can now load the data into the Shiny application</p>
</section>
</section>
<section id="building-the-models" class="level1">
<h1>Building the Models</h1>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The steps below are for the generating the model. The steps below are not necessary to use the Shiny but can be used as a reference.</p>
</div>
</div>
<section id="generating-the-new-geographically-weighted-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="generating-the-new-geographically-weighted-linear-model">Generating the new GeoGraphically Weighted Linear Model</h2>
<section id="loading-the-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-data">Loading the Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>rs_coords_full_rds <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/rs_coords_full.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-the-data" class="level3">
<h3 class="anchored" data-anchor-id="filtering-the-data">Filtering the Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="st">"2021-01"</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="st">"2022-12"</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>filter_flat_type <span class="ot">&lt;-</span> <span class="st">"4 ROOM"</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>resale_flat_full_nogeo <span class="ot">&lt;-</span>  <span class="fu">filter</span>(rs_coords_full_rds, flat_type <span class="sc">==</span> filter_flat_type) <span class="sc">%&gt;%</span> </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(month <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> end_date) <span class="sc">%&gt;%</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>, <span class="dv">19</span><span class="sc">:</span><span class="dv">38</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="st">"AREA_SQM"</span> <span class="ot">=</span> <span class="st">"floor_area_sqm"</span>, </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">"LEASE_YRS"</span> <span class="ot">=</span> <span class="st">"remaining_lease_mths"</span>, </span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"PRICE"</span><span class="ot">=</span> <span class="st">"resale_price"</span>,</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"AGE"</span><span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">"STOREY_ORDER"</span> <span class="ot">=</span> <span class="st">"storey_order"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">relocate</span>(<span class="st">"PRICE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">relocate</span>(geometry, <span class="at">.after =</span> <span class="fu">last_col</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_drop_geometry</span>() </span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>resale_flat_full <span class="ot">&lt;-</span>  <span class="fu">filter</span>(rs_coords_full_rds, flat_type <span class="sc">==</span> filter_flat_type) <span class="sc">%&gt;%</span> </span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(month <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> end_date) <span class="sc">%&gt;%</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>, <span class="dv">19</span><span class="sc">:</span><span class="dv">38</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="st">"AREA_SQM"</span> <span class="ot">=</span> <span class="st">"floor_area_sqm"</span>, </span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>               <span class="st">"LEASE_YRS"</span> <span class="ot">=</span> <span class="st">"remaining_lease_mths"</span>, </span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>               <span class="st">"PRICE"</span><span class="ot">=</span> <span class="st">"resale_price"</span>,</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>               <span class="st">"AGE"</span><span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>               <span class="st">"STOREY_ORDER"</span> <span class="ot">=</span> <span class="st">"storey_order"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">relocate</span>(<span class="st">"PRICE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">relocate</span>(geometry, <span class="at">.after =</span> <span class="fu">last_col</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>resale_flat_full_perdict<span class="ot">&lt;-</span> resale_flat_full <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>rs_coords_pred_rds <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(<span class="fu">as_Spatial</span>(<span class="fu">tail</span>(resale_flat_full_perdict,<span class="dv">10</span>)), <span class="st">"data/rds/rs_coords_predict.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-a-linear-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-linear-regression-model">Creating a Linear Regression Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>resale_mlr1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PRICE <span class="sc">~</span> AREA_SQM <span class="sc">+</span> LEASE_YRS <span class="sc">+</span> AGE <span class="sc">+</span> STOREY_ORDER <span class="sc">+</span> PROX_CBD <span class="sc">+</span> PROX_CHILDCARE <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_TOPPRISCH <span class="sc">+</span> PROX_MALL <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span> PROX_CLINIC <span class="sc">+</span> PROX_PHARMACY <span class="sc">+</span> PROX_TOURISM  <span class="sc">+</span> PROX_LIBRARY <span class="sc">+</span> NUM_KNDRGTN <span class="sc">+</span> NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_ISP_CLIN <span class="sc">+</span> NUM_REGISTERED_PHARM <span class="sc">+</span> NUM_LIBRARIES, resale_flat_full_nogeo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="moran-i-calculation" class="level2">
<h2 class="anchored" data-anchor-id="moran-i-calculation">Moran I Calculation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>resale_res_sf <span class="ot">&lt;-</span> <span class="fu">cbind</span>(resale_flat_full,resale_mlr1<span class="sc">$</span>residuals) <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="st">`</span><span class="at">MLR_RES</span><span class="st">`</span> <span class="ot">=</span> resale_mlr1.residuals)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>resale_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(resale_res_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="calculating-nearest-neighbour" class="level3">
<h3 class="anchored" data-anchor-id="calculating-nearest-neighbour">Calculating Nearest Neighbour</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(<span class="fu">coordinates</span>(resale_sp), <span class="dv">0</span>, <span class="dv">2500</span>, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-neighborhood-matrix" class="level3">
<h3 class="anchored" data-anchor-id="calculating-neighborhood-matrix">Calculating Neighborhood Matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>nb_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">'W'</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-moran-i" class="level3">
<h3 class="anchored" data-anchor-id="calculating-moran-i">Calculating Moran I</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>moran_value <span class="ot">&lt;-</span> <span class="fu">lm.morantest</span>(resale_mlr1, nb_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>moran_value_rds <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(moran_value, <span class="st">"data/rds/moran_value.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>moran_value_rds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="generating-geographically-weighted-regression" class="level2">
<h2 class="anchored" data-anchor-id="generating-geographically-weighted-regression">Generating Geographically Weighted Regression</h2>
<section id="calculating-adaptive-bandwidth" class="level3">
<h3 class="anchored" data-anchor-id="calculating-adaptive-bandwidth">Calculating Adaptive Bandwidth</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(<span class="at">formula =</span> PRICE <span class="sc">~</span> AREA_SQM <span class="sc">+</span> LEASE_YRS <span class="sc">+</span> AGE <span class="sc">+</span> STOREY_ORDER <span class="sc">+</span> PROX_CBD <span class="sc">+</span> PROX_CHILDCARE <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_TOPPRISCH <span class="sc">+</span> PROX_MALL <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span> PROX_CLINIC <span class="sc">+</span> PROX_PHARMACY <span class="sc">+</span> PROX_TOURISM  <span class="sc">+</span> PROX_LIBRARY <span class="sc">+</span> NUM_KNDRGTN <span class="sc">+</span> NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_ISP_CLIN <span class="sc">+</span> NUM_REGISTERED_PHARM <span class="sc">+</span> NUM_LIBRARIES, <span class="at">data=</span>resale_sp, <span class="at">approach=</span><span class="st">"CV"</span>, <span class="at">kernel=</span><span class="st">"gaussian"</span>,</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adaptive=</span><span class="cn">TRUE</span>, <span class="at">longlat=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="building-gwr-model" class="level3">
<h3 class="anchored" data-anchor-id="building-gwr-model">Building GWR Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span> PRICE <span class="sc">~</span> AREA_SQM <span class="sc">+</span> LEASE_YRS <span class="sc">+</span> AGE <span class="sc">+</span> STOREY_ORDER <span class="sc">+</span> PROX_CBD <span class="sc">+</span> PROX_CHILDCARE <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_TOPPRISCH <span class="sc">+</span> PROX_MALL <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span> PROX_CLINIC <span class="sc">+</span> PROX_PHARMACY <span class="sc">+</span> PROX_TOURISM  <span class="sc">+</span> PROX_LIBRARY <span class="sc">+</span> NUM_KNDRGTN <span class="sc">+</span> NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_ISP_CLIN <span class="sc">+</span> NUM_REGISTERED_PHARM <span class="sc">+</span> NUM_LIBRARIES,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data=</span>resale_sp, <span class="at">bw=</span><span class="dv">9121</span>, </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'gaussian'</span>, <span class="at">adaptive=</span><span class="cn">TRUE</span>, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive_rds <span class="ot">&lt;-</span> <span class="fu">write_rds</span>(gwr_adaptive, <span class="st">"data/rds/gwr_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>